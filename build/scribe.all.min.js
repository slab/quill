function LinkedList(){}function LinkedList(){}(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),window.rangy=function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e,t){t?window.alert(e):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(e)}function g(e){v.initialized=!0,v.supported=!1,m("Rangy is not supported on this page in your browser. Reason: "+e,v.config.alertOnFail)}function y(e){m("Rangy warning: "+e,v.config.alertOnWarn)}function E(){if(v.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0),e.detach());var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];if(!s||s.nodeName.toLowerCase()!="body"){g("No body element found");return}s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0));if(!t&&!n){g("Neither Range nor TextRange are available");return}v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};var o=w.concat(b);for(var f=0,l=o.length;f<l;++f)try{o[f](v)}catch(h){a(window,"console")&&u(window.console,"log")&&window.console.log("Rangy init listener threw an exception. Continuing.",h)}}function x(e){e=e||window,E();for(var t=0,n=S.length;t<n;++t)S[t](e)}function T(e){this.name=e,this.initialized=!1,this.supported=!1}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),v={version:"1.3alpha.681",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};v.fail=g,v.warn=y,{}.hasOwnProperty?v.util.extend=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&v.util.extend(r,i,!0),e[s]=i);return e}:g("hasOwnProperty not supported");var b=[],w=[];v.init=E,v.addInitListener=function(e){v.initialized?e(v):b.push(e)};var S=[];v.addCreateMissingNativeApiListener=function(e){S.push(e)},v.createMissingNativeApi=x,T.prototype={fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){v.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){v.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},v.createModule=function(e,t){var n=new T(e);v.modules[e]=n,w.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=v.modules[i];if(!r||!(r instanceof T))throw new Error("Module '"+i+"' not found");if(!r.supported)throw new Error("Module '"+i+"' not supported")}};var N=!1,C=function(e){N||(N=!0,v.initialized||E())};if(typeof window==n){g("No window found");return}if(typeof document==n){g("No document found");return}return u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",C,!1),u(window,"addEventListener")?window.addEventListener("load",C,!1):u(window,"attachEvent")?window.attachEvent("onload",C):g("Window does not have required addEventListener or attachEvent method"),v}(),rangy.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)t++;return t}function l(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t){return h(e,t,!0)}function d(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function v(e){var t=e.nodeType;return t==3||t==4||t==8}function m(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function g(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function y(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),g(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>f(e)&&++s.offset;return r}function b(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return b(e.parentNode);throw t.createError("getDocument: no document found for node")}function w(e){var r=b(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function E(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function S(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function x(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function T(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function N(e){var t;return e?r.isHostProperty(e,"nodeType")?t=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?E(e):b(e):T(e)&&(t=e.document):t=document,t}function C(e){var t;while(t=e.parentNode)e=t;return e}function k(e,n,r,i){var s,o,u,a,l;if(e==r)return n===i?0:n<i?-1:1;if(s=d(r,e,!0))return n<=f(s)?-1:1;if(s=d(e,r,!0))return f(s)<i?-1:1;o=c(e,r),u=e===o?o:d(e,o,!0),a=r===o?o:d(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");l=o.firstChild;while(l){if(l===u)return-1;if(l===a)return 1;l=l.nextSibling}}function L(e){if(!e)return"[No node]";if(v(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function A(e){var t=b(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function O(e){this.root=e,this._next=e}function M(e){return new O(e)}function _(e,t){this.node=e,this.offset=t}function D(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1};O.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},_.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+L(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,isOrIsAncestorOf:p,getClosestAncestorIn:d,isCharacterDataNode:v,isTextOrCommentNode:m,insertAfter:g,splitDataNode:y,getDocument:b,getWindow:w,getIframeWindow:S,getIframeDocument:E,getBody:x,isWindow:T,getContentDocument:N,getRootContainer:C,comparePoints:k,inspectNode:L,fragmentFromNodeChildren:A,createIterator:M,DomPosition:_},e.DOMException=D}),rangy.createModule("DomRange",function(e,t){function o(e,t){return e.nodeType!=3&&(n.isOrIsAncestorOf(e,t.startContainer)||n.isOrIsAncestorOf(e,t.endContainer))}function u(e){return n.getDocument(e.startContainer)}function a(e){return new i(e.parentNode,n.getNodeIndex(e))}function f(e){return new i(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;return n.isCharacterDataNode(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function c(e,t,r){q(e),q(t);if(u(t)!=u(e))throw new s("WRONG_DOCUMENT_ERR");var i=n.comparePoints(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=n.comparePoints(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?i<=0&&o>=0:i<0&&o>0}function h(e){var t;for(var n,r=u(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(h(i)),i.detach(!0));if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function p(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),p(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function d(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function v(e){for(var t,n=u(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(v(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function m(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return p(new y(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function g(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function y(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&n.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,!0))}}function b(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i))return s;s=s.parentNode}return null}}function O(e,t){if(A(e,t))throw new b("INVALID_NODE_TYPE_ERR")}function M(e){if(!e.startContainer)throw new s("INVALID_STATE_ERR")}function _(e,t){if(!n.arrayContains(t,e.nodeType))throw new b("INVALID_NODE_TYPE_ERR")}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function P(e,t){if(k(e,!0)!==k(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function H(e){if(L(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function B(e,t){if(!e)throw new s(t)}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,!0)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){return!!e.startContainer&&!!e.endContainer&&!j(e.startContainer)&&!j(e.endContainer)&&F(e.startContainer,e.startOffset)&&F(e.endContainer,e.endOffset)}function q(e){M(e);if(!I(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function X(e,t){q(e);var r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,u=r===s;n.isCharacterDataNode(s)&&o>0&&o<s.length&&n.splitDataNode(s,o,t),n.isCharacterDataNode(r)&&i>0&&i<r.length&&(r=n.splitDataNode(r,i,t),u?(o-=i,s=r):s==r.parentNode&&o>=n.getNodeIndex(r)&&o++,i=0),e.setStartAndEnd(r,i,s,o)}function tt(){}function nt(e){e.START_TO_START=$,e.START_TO_END=J,e.END_TO_END=K,e.END_TO_START=Q,e.NODE_BEFORE=G,e.NODE_AFTER=Y,e.NODE_BEFORE_AND_AFTER=Z,e.NODE_INSIDE=et}function rt(e){nt(e),nt(e.prototype)}function it(e,t){return function(){q(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,o=new y(this,!0),u,a;r!==s&&(u=n.getClosestAncestorIn(r,s,!0),a=f(u),r=a.node,i=a.offset),p(o,H),o.reset();var l=e(o);return o.detach(),t(this,r,i,r,i),l}}function st(e,t,i){function s(e,t){return function(n){M(this),_(n,w),_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,r,i){var s=e.endContainer,o=e.endOffset;if(r!==e.startContainer||i!==e.startOffset){if(C(r)!=C(s)||n.comparePoints(r,i,s,o)==1)s=r,o=i;t(e,r,i,s,o)}}function l(e,r,i){var s=e.startContainer,o=e.startOffset;if(r!==e.endContainer||i!==e.endOffset){if(C(r)!=C(s)||n.comparePoints(r,i,s,o)==-1)s=r,o=i;t(e,s,o,r,i)}}e.prototype=new tt,r.extend(e.prototype,{setStart:function(e,t){M(this),O(e,!0),D(e,t),u(this,e,t)},setEnd:function(e,t){M(this),O(e,!0),D(e,t),l(this,e,t)},setStartAndEnd:function(){M(this);var e=arguments,n=e[0],r=e[1],i=n,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}t(this,n,r,i,s)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){q(this),e?t(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):t(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(this),O(e,!0),t(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this),O(e,!1),_(e,w);var n=a(e),r=f(e);t(this,n.node,n.offset,r.node,r.offset)},extractContents:it(v,t),deleteContents:it(d,t),canSurroundContents:function(){q(this),H(this.startContainer),H(this.endContainer);var e=new y(this,!0),t=e._first&&o(e._first,this)||e._last&&o(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){X(this)},splitBoundariesPreservingPositions:function(e){X(this,e)},normalizeBoundaries:function(){q(this);var e=this.startContainer,r=this.startOffset,i=this.endContainer,s=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,s=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},u=function(t){var o=t.previousSibling;if(o&&o.nodeType==t.nodeType){e=t;var u=t.length;r=o.length,t.insertData(0,o.data),o.parentNode.removeChild(o);if(e==i)s+=r,i=e;else if(i==t.parentNode){var a=n.getNodeIndex(t);s==a?(i=t,s=u):s>a&&s--}}},a=!0;if(n.isCharacterDataNode(i))i.length==s&&o(i);else{if(s>0){var f=i.childNodes[s-1];f&&n.isCharacterDataNode(f)&&o(f)}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e))r==0&&u(e);else if(r<e.childNodes.length){var l=e.childNodes[r];l&&n.isCharacterDataNode(l)&&u(l)}}else e=i,r=s;t(this,e,r,i,s)},collapseToPoint:function(e,t){M(this),O(e,!0),D(e,t),this.setStartAndEnd(e,t)}}),rt(e)}function ot(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function ut(e,t,n,r,i){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,ot(e)}function at(e){M(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null}function ft(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,ot(this)}e.requireModules(["DomUtil"]);var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException;y.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,r;!n.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,r=e===this.ec?this.eo:e.length,t!=r&&e.deleteData(t,r-t))},isPartiallySelectedSubtree:function(){var e=this._current;return o(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new ft(u(this.range));var t=this._current,r=t,i=0,s=t,o=n.getNodeLength(t);n.isOrIsAncestorOf(t,this.sc)&&(r=this.sc,i=this.so),n.isOrIsAncestorOf(t,this.ec)&&(s=this.ec,o=this.eo),ut(e,r,i,s,o)}return new y(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},b.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},b.prototype.toString=function(){return this.message};var w=[1,3,4,5,7,8,10],E=[2,9,11],S=[5,6,10,12],x=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],C=n.getRootContainer,k=N([9,11]),L=N(S),A=N([6,10,12]),R=document.createElement("style"),U=!1;try{R.innerHTML="<b>x</b>",U=R.firstChild.nodeType==3}catch(z){}e.features.htmlParsingConforms=U;var W=U?function(e){var t=this.startContainer,r=n.getDocument(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:n.isCharacterDataNode(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){M(this);var t=u(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},V=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],$=0,J=1,K=2,Q=3,G=0,Y=1,Z=2,et=3;tt.prototype={compareBoundaryPoints:function(e,t){q(this),P(this.startContainer,t.startContainer);var r,i,s,o,u=e==Q||e==$?"start":"end",a=e==J||e==$?"start":"end";return r=this[u+"Container"],i=this[u+"Offset"],s=t[a+"Container"],o=t[a+"Offset"],n.comparePoints(r,i,s,o)},insertNode:function(e){q(this),_(e,x),H(this.startContainer);if(n.isOrIsAncestorOf(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){q(this);var e,t;if(this.collapsed)return u(this).createDocumentFragment();if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=u(this).createDocumentFragment(),t.appendChild(e),t;var r=new y(this,!0);return e=h(r),r.detach(),e},canSurroundContents:function(){q(this),H(this.startContainer),H(this.endContainer);var e=new y(this,!0),t=e._first&&o(e._first,this)||e._last&&o(e._last,this);return e.detach(),!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents())throw new b("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);l(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){q(this);var e=new ft(u(this)),t=V.length,n;while(t--)n=V[t],e[n]=this[n];return e},toString:function(){q(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new y(this,!0);return p(r,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){q(this);var t=e.parentNode,r=n.getNodeIndex(e);if(!t)throw new s("NOT_FOUND_ERR");var i=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return i<0?o>0?Z:G:o>0?Y:et},comparePoint:function(e,t){return q(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:n.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:W,toHtml:function(){q(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){q(this),B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==u(this))return!1;var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),o=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&o>=0:s<0&&o>0},isPointInRange:function(e,t){return q(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return c(this,e,!1)},intersectsOrTouchesRange:function(e){return c(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return t==-1&&i.setStart(e.startContainer,e.startOffset),r==1&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new b("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==et},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},getNodes:function(e,t){return q(this),m(this,e,t)},getDocument:function(){return u(this)},collapseBefore:function(e){M(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){M(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return ft.rangesEqual(this,e)},isValid:function(){return I(this)},inspect:function(){return g(this)}},st(ft,ut,at),e.rangePrototype=tt.prototype,r.extend(ft,{rangeProperties:V,RangeIterator:y,copyComparisonConstants:rt,createPrototypeRange:st,inspect:g,getRangeDocument:u,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=ft,e.RangeException=b}),rangy.createModule("WrappedRange",function(e,t){function u(e,n){e=r.getContentDocument(e);if(!e)throw t.createError(n+"(): Parameter must be a Document or other DOM node, or a Window object");return e}function a(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function f(e){return e.compareEndPoints("StartToEnd",e)==0}function l(e,t,n,i,o){var u=e.duplicate();u.collapse(n);var a=u.parentElement();r.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML)return new s(a.parentNode,r.getNodeIndex(a));var f=r.getDocument(a).createElement("span");f.parentNode&&f.parentNode.removeChild(f);var l,c=n?"StartToStart":"StartToEnd",h,p,d,v,m=o&&o.containerElement==a?o.nodeIndex:0,g=a.childNodes.length,y=g,b=y;for(;;){b==g?a.appendChild(f):a.insertBefore(f,a.childNodes[b]),u.moveToElementText(f),l=u.compareEndPoints(c,e);if(l==0||m==y)break;if(l==-1){if(y==m+1)break;m=b}else y=y==m+1?m:b;b=Math.floor((m+y)/2),a.removeChild(f)}v=f.nextSibling;if(l==-1&&v&&r.isCharacterDataNode(v)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var w;if(/[\r\n]/.test(v.data)){var E=u.duplicate(),S=E.text.replace(/\r\n/g,"\r").length;w=E.moveStart("character",S);while((l=E.compareEndPoints("StartToEnd",E))==-1)w++,E.moveStart("character",1)}else w=u.text.length;d=new s(v,w)}else h=(i||!n)&&f.previousSibling,p=(i||n)&&f.nextSibling,p&&r.isCharacterDataNode(p)?d=new s(p,0):h&&r.isCharacterDataNode(h)?d=new s(h,h.data.length):d=new s(a,r.getNodeIndex(f));return f.parentNode.removeChild(f),{boundaryPosition:d,nodeInfo:{nodeIndex:b,containerElement:a}}}function c(e,t){var n,i,s=e.offset,o=r.getDocument(e.node),u,a,f=o.body.createTextRange(),l=r.isCharacterDataNode(e.node);return l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?i.insertBefore(u,n):i.appendChild(u),f.moveToElementText(u),f.collapse(!t),i.removeChild(u),l&&f[t?"moveStart":"moveEnd"]("character",s),f}e.requireModules(["DomUtil","DomRange"]);var n,r=e.dom,i=e.util,s=r.DomPosition,o=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange))(function(){function u(e){var t=s.length,n;while(t--)n=s[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}function f(e){e.nativeRange.detach(),e.detached=!0;var t=s.length,n;while(t--)n=s[t],e[n]=null}var e,s=o.rangeProperties,l;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},o.createPrototypeRange(n,a,f),e=n.prototype,e.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},e.collapse=function(e){this.nativeRange.collapse(e),u(this)},e.cloneRange=function(){return new n(this.nativeRange.cloneRange())},e.refresh=function(){u(this)},e.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),e.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},e.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){e.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},e.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}e.setStartBefore=l("setStartBefore","setEndBefore"),e.setStartAfter=l("setStartAfter","setEndAfter"),e.setEndBefore=l("setEndBefore","setStartBefore"),e.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length?e.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),u(this)}:e.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,o.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),h.compareBoundaryPoints(h.START_TO_END,d)==-1&&h.compareBoundaryPoints(h.END_TO_START,d)==1?e.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:e.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var m=v.firstChild;document.body.appendChild(v),h.setStart(m,1),h.setEnd(m,2),h.deleteContents(),m.data=="13"&&(e.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},e.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),document.body.removeChild(v),i.isHostMethod(h,"createContextualFragment")&&(e.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(c),h.detach(),d.detach()})(),e.createNativeRange=function(e){return e=u(e,"createNativeRange"),e.createRange()};else if(e.features.implementsTextRange){n=function(e){this.textRange=e,this.refresh()},n.prototype=new o(document),n.prototype.refresh=function(){var e,t,n,r=a(this.textRange);f(this.textRange)?t=e=l(this.textRange,r,!0,!0).boundaryPosition:(n=l(this.textRange,r,!0,!1),e=n.boundaryPosition,t=l(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.copyComparisonConstants(n);var h=function(){return this}();typeof h.Range=="undefined"&&(h.Range=n),e.createNativeRange=function(e){return e=u(e,"createNativeRange"),e.body.createTextRange()}}e.features.implementsTextRange&&(n.rangeToTextRange=function(e){if(e.collapsed)return c(new s(e.startContainer,e.startOffset),!0);var t=c(new s(e.startContainer,e.startOffset),!0),n=c(new s(e.endContainer,e.endOffset),!1),i=r.getDocument(e.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i}),n.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createRange=function(t){return t=u(t,"createRange"),new n(e.createNativeRange(t))},e.createRangyRange=function(e){return e=u(e,"createRangyRange"),new o(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function h(e){return typeof e=="string"?e=="backward":!!e}function p(e,n){if(!e)return window;if(r.isWindow(e))return e;if(e instanceof q)return e.win;var i=r.getContentDocument(e);if(!i)throw t.createError(n+"(): "+"Parameter must be a Window object or DOM node");return r.getWindow(i)}function d(e){return p(e,"getWinSelection").getSelection()}function v(e){return p(e,"getDocSelection").document.selection}function A(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function O(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function M(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function _(t){var n;return t instanceof s?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof o?n=t.nativeRange:e.features.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(n=t),n}function D(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!r.isAncestorOf(e[0],e[t]))return!1;return!0}function P(e){var n=e.getNodes();if(!D(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function H(e){return!!e&&typeof e.text!="undefined"}function B(e,t){var n=new o(t);e._ranges=[n],A(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function j(t){t._ranges.length=0;if(t.docSelection.type=="None")M(t);else{var n=t.docSelection.createRange();if(H(n))B(t,n);else{t.rangeCount=n.length;var i,s=r.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o)i=e.createRange(s),i.selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,A(t,t._ranges[t.rangeCount-1],!1)}}}function F(e,n){var i=e.docSelection.createRange(),s=P(n),o=r.getDocument(i.item(0)),u=r.getBody(o).createControlRange();for(var a=0,f=i.length;a<f;++a)u.add(i.item(a));try{u.add(s)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}u.select(),j(e)}function q(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.detached=!0}function z(e,t){var n=U.length,r,i;while(n--){r=U[n],i=r.selection;if(t=="deleteAll")R(i);else if(r.win==e)return t=="delete"?(U.splice(n,1),!0):i}return t=="deleteAll"&&(U.length=0),null}function X(e,n){var i=r.getDocument(n[0].startContainer),s=r.getBody(i).createControlRange();for(var o=0,u;o<rangeCount;++o){u=P(n[o]);try{s.add(u)}catch(a){throw t.createError("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}s.select(),j(e)}function Q(e,t){if(e.anchorNode&&r.getDocument(e.anchorNode)!==r.getDocument(t))throw new u("WRONG_DOCUMENT_ERR")}function G(e){var t=[],n=new a(e.anchorNode,e.anchorOffset),r=new a(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var o=0,u=e.rangeCount;o<u;++o)t[o]=s.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var n="boolean",r=e.dom,i=e.util,s=e.DomRange,o=e.WrappedRange,u=e.DOMException,a=r.DomPosition,f,l,c="Control",m=e.util.isHostMethod(window,"getSelection"),g=e.util.isHostObject(document,"selection");e.features.implementsWinGetSelection=m,e.features.implementsDocSelection=g;var y=g&&(!m||e.config.preferTextRange);y?(f=v,e.isSelectionValid=function(e){var t=p(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||r.getDocument(n.createRange().parentElement())==t}):m?(f=d,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=f;var b=f(),w=e.createNativeRange(document),E=r.getBody(document),S=i.areHostProperties(b,["anchorNode","focusNode","anchorOffset","focusOffset"]);e.features.selectionHasAnchorAndFocus=S;var x=i.isHostMethod(b,"extend");e.features.selectionHasExtend=x;var T=typeof b.rangeCount=="number";e.features.selectionHasRangeCount=T;var N=!1,C=!0;i.areHostMethods(b,["addRange","getRangeAt","removeAllRanges"])&&typeof b.rangeCount=="number"&&e.features.implementsDomRange&&function(){var e=window.getSelection();if(e){var t=r.getBody(document),n=t.appendChild(document.createElement("div"));n.contentEditable="false";var i=n.appendChild(document.createTextNode("")),s=document.createRange();s.setStart(i,1),s.collapse(!0),e.addRange(s),C=e.rangeCount==1,e.removeAllRanges();var o=s.cloneRange();s.setStart(i,0),o.setEnd(i,3),o.setStart(i,2),e.addRange(s),e.addRange(o),N=e.rangeCount==2,t.removeChild(n),e.removeAllRanges(),s.detach(),o.detach()}}(),e.features.selectionSupportsMultipleRanges=N,e.features.collapsedNonEditableSelectionsSupported=C;var k=!1,L;E&&i.isHostMethod(E,"createControlRange")&&(L=E.createControlRange(),i.areHostProperties(L,["item","add"])&&(k=!0)),e.features.implementsControlRange=k,S?l=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:l=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var I;i.isHostMethod(b,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:S&&(I=function(t){var n=r.getDocument(t.anchorNode),i=e.createRange(n);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i});var U=[];e.getSelection=function(e){if(e&&e instanceof q)return e.refresh(),e;e=p(e,"getSelection");var t=z(e),n=f(e),r=g?v(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new q(n,r,e),U.push({win:e,selection:t})),t},e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(r.getIframeWindow(n))};var W=q.prototype;if(!y&&S&&i.areHostMethods(b,["removeAllRanges","addRange"])){W.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),M(this)};var V=function(t,n){var r=s.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(_(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};T?W.addRange=function(t,n){if(k&&g&&this.docSelection.type==c)F(this,t);else if(h(n)&&x)V(this,t);else{var r;N?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(_(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=I(this.nativeSelection,this.rangeCount-1);i&&!s.rangesEqual(i,t)&&(t=new o(i))}this._ranges[this.rangeCount-1]=t,A(this,t,K(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:W.addRange=function(e,t){h(t)&&x?V(this,e):(this.nativeSelection.addRange(_(e)),this.refresh())},W.setRanges=function(e){if(k&&e.length>1)X(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(i.isHostMethod(b,"empty")&&i.isHostMethod(w,"select")&&k&&y))return t.fail("No means of selecting a Range or TextRange was found"),!1;W.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=r.getDocument(this.anchorNode);else if(this.docSelection.type==c){var t=this.docSelection.createRange();t.length&&(e=r.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}M(this)},W.addRange=function(e){this.docSelection.type==c?F(this,e):(o.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,A(this,e,!1))},W.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?X(this,e):t&&this.addRange(e[0])}}W.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new u("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var $;if(y)$=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=r.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==c?j(t):H(n)?B(t,n):M(t)};else if(i.isHostMethod(b,"getRangeAt")&&typeof b.rangeCount=="number")$=function(t){if(k&&g&&t.docSelection.type==c)j(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));A(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=l(t)}else M(t)}};else{if(!S||typeof b.isCollapsed!=n||typeof w.collapsed!=n||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;$=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=I(n,0),e._ranges=[t],e.rangeCount=1,O(e),e.isCollapsed=l(e)):M(e)}}W.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;$(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!s.rangesEqual(t[i],this._ranges[i]))return!0;return!1}};var J=function(t,n){var r=t.getAllRanges();t.removeAllRanges();for(var i=0,s=r.length;i<s;++i)e.DomRange.rangesEqual(n,r[i])||t.addRange(r[i]);t.rangeCount||M(t)};k?W.removeRange=function(e){if(this.docSelection.type==c){var t=this.docSelection.createRange(),n=P(e),i=r.getDocument(t.item(0)),s=r.getBody(i).createControlRange(),o,u=!1;for(var a=0,f=t.length;a<f;++a)o=t.item(a),o!==n||u?s.add(t.item(a)):u=!0;s.select(),j(this)}else J(this,e)}:W.removeRange=function(e){J(this,e)};var K;!y&&S&&e.features.implementsDomRange?(K=function(e){var t=!1;return e.anchorNode&&(t=r.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t},W.isBackward=function(){return K(this)}):K=W.isBackward=function(){return!1},W.isBackwards=W.isBackward,W.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},W.collapse=function(t,n){Q(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},W.collapseToStart=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},W.collapseToEnd=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},W.selectAllChildren=function(t){Q(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},W.deleteFromDocument=function(){if(k&&g&&this.docSelection.type==c){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}}},W.getAllRanges=function(){var e=[];for(var t=0,n=this._ranges.length;t<n;++t)e[t]=this.getRangeAt(t);return e},W.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},W.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},W.toHtml=function(){var e=[];if(this.rangeCount)for(var t=0,n=this._ranges.length;t<n;++t)e.push(this._ranges[t].toHtml());return e.join("")},W.getName=function(){return"WrappedSelection"},W.inspect=function(){return G(this)},W.detach=function(){z(this.win,"delete"),R(this)},q.detachAll=function(){z(null,"deleteAll")},q.inspect=G,q.isDirectionBackward=h,e.Selection=q,e.selectionPrototype=W,e.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return e.getSelection(t)}),t=null})}),rangy.createModule("SaveRestore",function(e,t){function i(e,t){return(t||document).getElementById(e)}function s(e,t){var i="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),s,o=n.getDocument(e.startContainer),u=e.cloneRange();return u.collapse(t),s=o.createElement("span"),s.id=i,s.style.lineHeight="0",s.style.display="none",s.className="rangySelectionBoundary",s.appendChild(o.createTextNode(r)),u.insertNode(s),u.detach(),s}function o(e,n,r,s){var o=i(r,e);o?(n[s?"setStartBefore":"setEndBefore"](o),o.parentNode.removeChild(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function u(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(t,n){var r,i,o=e.DomRange.getRangeDocument(t),u=t.toString();return t.collapsed?(i=s(t,!1),{document:o,markerId:i.id,collapsed:!0}):(i=s(t,!1),r=s(t,!0),{document:o,startMarkerId:r.id,endMarkerId:i.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+u+"', new text: '"+t.toString()+"'"}})}function f(n,r){var s=n.document;typeof r=="undefined"&&(r=!0);var u=e.createRange(s);if(n.collapsed){var a=i(n.markerId,s);if(a){a.style.display="inline";var f=a.previousSibling;f&&f.nodeType==3?(a.parentNode.removeChild(a),u.collapseToPoint(f,f.length)):(u.collapseBefore(a),a.parentNode.removeChild(a))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(s,u,n.startMarkerId,!0),o(s,u,n.endMarkerId,!1);return r&&u.normalizeBoundaries(),u}function l(t,n){var r=[],s,o;t=t.slice(0),t.sort(u);for(var f=0,l=t.length;f<l;++f)r[f]=a(t[f],n);for(f=l-1;f>=0;--f)s=t[f],o=e.DomRange.getRangeDocument(s),s.collapsed?s.collapseAfter(i(r[f].markerId,o)):(s.setEndBefore(i(r[f].endMarkerId,o)),s.setStartAfter(i(r[f].startMarkerId,o)));return r}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),s=i.length==1&&r.isBackward(),o=l(i,s);return r.setRanges(i),{win:n,rangeInfos:o,restored:!1}}function h(e){var t=[],n=e.length;for(var r=n-1;r>=0;r--)t[r]=f(e[r],!0);return t}function p(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),s=h(r),o=r.length;o==1&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0}}function d(e,t){var n=i(t,e);n&&n.parentNode.removeChild(n)}function v(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n)i=t[n],i.collapsed?d(e.doc,i.markerId):(d(e.doc,i.startMarkerId),d(e.doc,i.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var n=e.dom,r="";e.util.extend(e,{saveRange:a,restoreRange:f,saveRanges:l,restoreRanges:h,saveSelection:c,restoreSelection:p,removeMarkerElement:d,removeMarkers:v})}),!function(e,t){function i(){this._events=new Object}function s(e){e&&(e.delimiter&&(this.delimiter=e.delimiter),e.wildcard&&(this.wildcard=e.wildcard),this.wildcard&&(this.listenerTree=new Object))}function o(e){this._events=new Object,s.call(this,e)}function u(e,t,n,r){if(!n)return[];var i=[],s,o,a,f,l,c,h,p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if(typeof n._listeners=="function")return e&&e.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)e&&e.push(n._listeners[s]);return[n]}if(d==="*"||d==="**"||n[d]){if(d==="*"){for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(i=i.concat(u(e,t,n[a],r+1)));return i}if(d==="**"){h=r+1===p||r+2===p&&v==="*",h&&n._listeners&&(i=i.concat(u(e,t,n,p)));for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(a==="*"||a==="**"?(n[a]._listeners&&!h&&(i=i.concat(u(e,t,n[a],p))),i=i.concat(u(e,t,n[a],r))):a===v?i=i.concat(u(e,t,n[a],r+2)):i=i.concat(u(e,t,n[a],r)));return i}i=i.concat(u(e,t,n[d],r+1))}f=n["*"],f&&u(e,t,f,r+1),l=n["**"];if(l)if(r<p){l._listeners&&u(e,t,l,p);for(a in l)a!=="_listeners"&&l.hasOwnProperty(a)&&(a===v?u(e,t,l[a],r+2):a===d?u(e,t,l[a],r+1):(c={},c[a]=l[a],u(e,t,{"**":c},r+1)))}else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return i}function a(e,t){e=typeof e=="string"?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;i+1<s;i++)if(e[i]==="**"&&e[i+1]==="**")return;var o=this.listenerTree,u=e.shift();while(u){o[u]||(o[u]=new Object),o=o[u];if(e.length===0){if(!o._listeners)o._listeners=t;else if(typeof o._listeners=="function")o._listeners=[o._listeners,t];else if(n(o._listeners)){o._listeners.push(t);if(!o._listeners.warned){var a=r;typeof this._events.maxListeners!="undefined"&&(a=this._events.maxListeners),a>0&&o._listeners.length>a&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}return!0}u=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function i(){--t===0&&r.off(e,i),n.apply(this,arguments)}var r=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(e==="newListener"&&!this._events.newListener)return!1;if(this._all){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;r<t;r++)this.event=e,this._all[r].apply(this,n)}if(e==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o=typeof e=="string"?e.split(this.delimiter):e.slice();u.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if(typeof s=="function"){this.event=e;if(arguments.length===1)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];var a=s.slice();for(var r=0,t=a.length;r<t;r++)this.event=e,a[r].apply(this,n);return a.length>0||this._all}return this._all},o.prototype.on=function(e,t){if(typeof e=="function")return this.onAny(e),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||i.call(this),this.emit("newListener",e,t);if(this.wildcard)return a.call(this,e,t),this;if(!this._events[e])this._events[e]=t;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],t];else if(n(this._events[e])){this._events[e].push(t);if(!this._events[e].warned){var s=r;typeof this._events.maxListeners!="undefined"&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},o.prototype.onAny=function(e){this._all||(this._all=[]);if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s=typeof e=="string"?e.split(this.delimiter):e.slice();i=u.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var o=0;o<i.length;o++){var a=i[o];r=a._listeners;if(n(r)){var f=-1;for(var l=0,c=r.length;l<c;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){f=l;break}if(f<0)return this;this.wildcard?a._listeners.splice(f,1):this._events[e].splice(f,1),r.length===0&&(this.wildcard?delete a._listeners:delete this._events[e])}else if(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)this.wildcard?delete a._listeners:delete this._events[e]}return this},o.prototype.offAny=function(e){var t=0,n=0,r;if(e&&this._all&&this._all.length>0){r=this._all;for(t=0,n=r.length;t<n;t++)if(e===r[t])return r.splice(t,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(arguments.length===0)return!this._events||i.call(this),this;if(this.wildcard){var t=typeof e=="string"?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0);for(var r=0;r<n.length;r++){var s=n[r];s._listeners=null}}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r=typeof e=="string"?e.split(this.delimiter):e.slice();return u.call(this,t,r,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},typeof define=="function"&&define.amd?define(function(){return o}):e.EventEmitter2=o}(typeof process!="undefined"&&typeof process.title!="undefined"&&typeof exports!="undefined"?exports:window),LinkedList.prototype={length:0,first:null,last:null},LinkedList.prototype.append=function(e){typeof this.first=="undefined"||this.first===null?this.first=e:(e.next=null,this.last.next=e),e.prev=this.last,this.last=e,this.length++},LinkedList.prototype.insertAfter=function(e,t){t.prev=e,e?(t.next=e.next,typeof e.next!="undefined"&&e.next!==null&&(e.next.prev=t),e.next=t,e===this.last&&(this.last=t)):(t.next=this.first,this.first.prev=t,this.first=t),this.length++},LinkedList.prototype.remove=function(e){this.length>1?(typeof e.prev!="undefined"&&e.prev!==null&&(e.prev.next=e.next),typeof e.next!="undefined"&&e.next!==null&&(e.next.prev=e.prev),e==this.first&&(this.first=e.next),e==this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.prev=null,e.next=null,this.length--},LinkedList.prototype.toArray=function(){var e=[],t=this.first;while(t)e.push(t),t=t.next;return e},LinkedList.Node=function(e){this.prev=null,this.next=null,this.data=e},function(){var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=e.cache[r],o=s?s.exports:i();return o};e.paths=[],e.modules={},e.cache={},e.extensions=[".js",".coffee",".json"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){t=r.normalize(t);if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var i=e.extensions[n];if(e.modules[t+i])return t+i}}function a(t){t=t.replace(/\/+$/,"");var n=r.normalize(t+"/package.json");if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},function(){var t={},n=typeof window!="undefined"?window:{},r=!1;e.define=function(i,s){!r&&e.modules.__browserify_process&&(t=e.modules.__browserify_process(),r=!0);var o=e._core[i]?"":e.modules.path().dirname(i),u=function(t){var n=e(t,o),r=e.cache[e.resolve(t,o)];return r&&r.parent===null&&(r.parent=a),n};u.resolve=function(t){return e.resolve(t,o)},u.modules=e.modules,u.define=e.define,u.cache=e.cache;var a={id:i,filename:i,exports:{},loaded:!1,parent:null};e.modules[i]=function(){return e.cache[i]=a,s.call(a.exports,u,a,a.exports,o,i,t,n),a.loaded=!0,a.exports}}}(),e.define("path",function(e,t,n,r,i,s,o){function u(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function a(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var f=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:s.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=a(u(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=a(u(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(u(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=f.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=f.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return f.exec(e)[3]||""}}),e.define("__browserify_process",function(e,t,n,r,i,s,o){var s=t.exports={};s.nextTick=function(){var e=typeof window!="undefined"&&window.setImmediate,t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){if(e.source===window&&e.data==="browserify-tick"){e.stopPropagation();if(n.length>0){var t=n.shift();t()}}},!0),function(t){n.push(t),window.postMessage("browserify-tick","*")}}return function(t){setTimeout(t,0)}}(),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module. (Possibly not yet loaded)")},function(){var t="/",n;s.cwd=function(){return t},s.chdir=function(r){n||(n=e("path")),t=n.resolve(r,t)}}()}),e.define("/src/core/delta.coffee",function(e,t,n,r,i,s,o){(function(){var n,r,i,s,o,u,a,f=[].slice;typeof t!="undefined"&&t!==null&&(a=e("underscore")._),o=e("googlediff"),i=e("./op"),r=e("./insert"),s=e("./retain"),u=new o,u.DIFF_DELETE=-1,u.DIFF_EQUAL=0,u.DIFF_INSERT=1,n=function(){function e(e,t,n){var r;this.startLength=e,this.endLength=t,this.ops=n,this.ops==null&&(this.ops=this.endLength,this.endLength=null),this.compact(),r=a.reduce(this.ops,function(e,t){return e+t.getLength()},0),this.endLength!=null?console.assert(r===this.endLength,"Expecting end length of",r,this):this.endLength=r}return e.copy=function(t){var n,i,o,u,a;n=[],a=t.ops;for(o=0,u=a.length;o<u;o++)i=a[o],e.isRetain(i)?n.push(s.copy(i)):n.push(r.copy(i));return new e(t.startLength,t.endLength,n)},e.getIdentity=function(t){var n;return n=new e(t,t,[new s(0,t)]),n},e.getInitial=function(t){return new e(0,t.length,[new r(t)])},e.isDelta=function(t){var n,r,i,s;if(t!=null&&typeof t=="object"&&typeof t.startLength=="number"&&typeof t.endLength=="number"&&typeof t.ops=="object"){s=t.ops;for(r=0,i=s.length;r<i;r++){n=s[r];if(!e.isRetain(n)&&!e.isInsert(n))return!1}return!0}return!1},e.isInsert=function(e){return r.isInsert(e)},e.isRetain=function(e){return s.isRetain(e)||typeof e=="number"},e.makeDelta=function(t){return new e(t.startLength,t.endLength,t.ops)},e.prototype.apply=function(t,n,r,i){var o,u,f,l=this;i==null&&(i=null);if(this.isIdentity())return;return o=0,u=0,f=[],a.each(this.ops,function(r){return e.isInsert(r)?(t.call(i,o+u,r.value,r.attributes),u+=r.getLength()):e.isRetain(r)?(r.start>o&&(n.call(i,o+u,r.start-o),u-=r.start-o),f.push(new s(r.start+u,r.end+u,r.attributes)),o=r.end):console.warn("Unrecognized type in delta",r)}),this.endLength<this.startLength+u&&n.call(i,this.endLength,this.startLength+u-this.endLength),a.each(f,function(e){return a.each(e.attributes,function(t,n){if(t===null)return r.call(i,e.start,e.end-e.start,n,t)}),a.each(e.attributes,function(t,n){if(t!=null)return r.call(i,e.start,e.end-e.start,n,t)})})},e.prototype.applyToText=function(t){var n,r,i,s,o,u,a;r=this,console.assert(t.length===r.startLength,"Start length of delta: "+r.startLength+" is not equal to the text: "+t.length),n=[],a=r.ops;for(o=0,u=a.length;o<u;o++)i=a[o],e.isInsert(i)?n.push(i.value):n.push(t.substring(i.start,i.end));return s=n.join(""),r.endLength!==s.length&&(console.log("Delta",r),console.log("text",t),console.log("result",s),console.assert(!1,"End length of delta: "+r.endLength+" is not equal to result text: "+s.length)),s},e.prototype.canCompose=function(t){return e.isDelta(t)&&this.endLength===t.startLength},e.prototype.compact=function(){var e;return this.normalize(),e=[],a.each(this.ops,function(t){var n;if(e.length!==0){if(s.isRetain(t)&&t.start===t.end)return;return n=a.last(e),r.isInsert(n)&&r.isInsert(t)&&n.attributesMatch(t)?n.value=n.value+t.value:s.isRetain(n)&&s.isRetain(t)&&n.end===t.start&&n.attributesMatch(t)?n.end=t.end:e.push(t)}if(!s.isRetain(t)||t.start!==t.end)return e.push(t)}),this.ops=e},e.prototype.compose=function(t){var n,i,o,u,f,l,c,h;console.assert(this.canCompose(t),"Cannot compose delta",this,t),i=new e(this.startLength,this.endLength,this.ops),t=new e(t.startLength,t.endLength,t.ops),n=[],h=t.ops;for(l=0,c=h.length;l<c;l++)u=h[l],typeof u=="string"&&(u=new r(u)),e.isInsert(u)?n.push(u):e.isRetain(u)?(f=i.getOpsAt(u.start,u.end-u.start),f=a.map(f,function(t){return e.isInsert(t)?new r(t.value,t.composeAttributes(u.attributes)):new s(t.start,t.end,t.composeAttributes(u.attributes))}),n=n.concat(f)):console.assert(!1,"Invalid op in deltaB when composing",t);return o=new e(i.startLength,t.endLength,n),console.assert(e.isDelta(o),"Composed returning invalid Delta",o),o},e.prototype.decompose=function(t){var n,i,o,u,f,l;return o=this,console.assert(e.isDelta(t),"Decompose called when deltaA is not a Delta, type: "+typeof t),console.assert(t.startLength===this.startLength,"startLength "+t.startLength+" / startLength "+this.startLength+" mismatch"),console.assert(a.all(t.ops,function(e){return e.value!=null}),"DeltaA has retain in decompose"),console.assert(a.all(o.ops,function(e){return e.value!=null}),"DeltaC has retain in decompose"),n=function(e,t){var r,i,s;r={};for(i in t){s=t[i];if(e[i]===void 0||e[i]!==s)e[i]!==null&&typeof e[i]=="object"&&s!==null&&typeof s=="object"?r[i]=n(e[i],s):r[i]=s}for(i in e)s=e[i],t[i]===void 0&&(r[i]=null);return r},u=t.diff(o),l=[],f=0,a.each(u.ops,function(u){var c,h;return h=o.getOpsAt(f,u.getLength()),c=0,a.each(h,function(o){var f,h,p;return e.isInsert(u)?(f=new r(u.value.substring(c,c+o.getLength()),o.attributes),l.push(f)):e.isRetain(u)?(p=t.getOpsAt(u.start+c,o.getLength()),h=0,a.each(p,function(e){var t,r,i;return t=n(e.attributes,o.attributes),i=u.start+h+c,r=new s(i,i+e.getLength(),t),l.push(r),h+=e.getLength()})):console.error("Invalid delta in deltaB when composing",i),c+=o.getLength()}),f+=u.getLength()}),i=new e(u.startLength,u.endLength,l),i},e.prototype.diff=function(t){var n,i,o,f,l,c,h;return f=function(t){var n,i,o,a,f,l,c,h;console.assert(t.length>0,"diffToDelta called with diff with length <= 0"),a=0,n=0,o=[];for(l=0,c=t.length;l<c;l++){h=t[l],i=h[0],f=h[1];switch(i){case u.DIFF_DELETE:a+=f.length;break;case u.DIFF_INSERT:o.push(new r(f)),n+=f.length;break;case u.DIFF_EQUAL:o.push(new s(a,a+f.length)),a+=f.length,n+=f.length}}return new e(a,n,o)},n=function(e){return a.map(e.ops,function(e){return e.value!=null?e.value:""}).join("")},o=function(e,t){var n;return n=u.diff_main(e,t),n},c=n(this),h=n(t),c!==""||h!==""?(i=o(c,h),l=f(i)):l=new e(0,0,[]),l},e.prototype.follows=function(t,n){var r,i,o,u,f,l,c,h,p,d,v,m,g,y,b,w;i=this,console.assert(e.isDelta(t),"Follows called when deltaA is not a Delta, type: "+typeof t,t),console.assert(n!=null,"Remote delta not specified"),t=new e(t.startLength,t.endLength,t.ops),i=new e(i.startLength,i.endLength,i.ops),v=t.endLength,d=[],m=g=0,l=c=0;while(l<t.ops.length&&c<i.ops.length)u=t.ops[l],f=i.ops[c],e.isInsert(u)&&e.isInsert(f)?(y=Math.min(u.getLength(),f.getLength()),n?(d.push(new s(m,m+y)),m+=y,y===u.getLength()?l++:(console.assert(y<u.getLength()),t.ops[l]=a.last(u.split(y)))):(d.push(a.first(f.split(y))),g+=y,y===f.getLength()?c++:i.ops[c]=a.last(f.split(y)))):e.isRetain(u)&&e.isRetain(f)?u.end<f.start?(m+=u.getLength(),l++):f.end<u.start?(g+=f.getLength(),c++):(u.start<f.start?(m+=f.start-u.start,u=t.ops[l]=new s(f.start,u.end,u.attributes)):f.start<u.start&&(g+=u.start-f.start,f=i.ops[c]=new s(u.start,f.end,f.attributes)),console.assert(u.start===f.start,"RetainOps must have same          start length when propagating into followset",u,f),y=Math.min(u.end,f.end)-u.start,r=u.addAttributes(f.attributes),d.push(new s(m,m+y,r)),m+=y,g+=y,u.end===f.end?(l++,c++):u.end<f.end?(l++,i.ops[c]=a.last(f.split(y))):(t.ops[l]=a.last(u.split(y)),c++)):e.isInsert(u)&&e.isRetain(f)?(d.push(new s(m,m+u.getLength())),m+=u.getLength(),l++):e.isRetain(u)&&e.isInsert(f)?(d.push(f),g+=f.getLength(),c++):console.warn("Mismatch. elemA is: "+typeof u+", elemB is:  "+typeof f);while(l<t.ops.length)u=t.ops[l],e.isInsert(u)&&d.push(new s(m,m+u.getLength())),m+=u.getLength(),l++;while(c<i.ops.length)f=i.ops[c],e.isInsert(f)&&d.push(f),g+=f.getLength(),c++;p=0;for(b=0,w=d.length;b<w;b++)o=d[b],p+=o.getLength();return h=new e(v,p,d),console.assert(e.isDelta(h),"Follows returning invalid Delta",h),h},e.prototype.getOpsAt=function(e,t){var n,r,i,s,o,u,a,f,l;n=[],this.savedOpOffset!=null&&this.savedOpOffset<e?i=this.savedOpOffset:i=this.savedOpOffset=this.savedOpIndex=0,l=this.ops.slice(this.savedOpIndex);for(a=0,f=l.length;a<f;a++){s=l[a];if(i>=e+t)break;o=s.getLength(),e<i+o&&(u=Math.max(e-i,0),r=Math.min(o-u,e+t-i-u),n.push(s.getAt(u,r))),i+=o,this.savedOpIndex+=1,this.savedOpOffset+=o}return n},e.prototype.invert=function(e){var t,n,r;return console.assert(this.isInsertsOnly(),"Invert called on invalid delta containing non-insert ops: "+t),t=this,n=t.compose(e),r=t.decompose(n),r},e.prototype.isEqual=function(e){var t;return e?(t=["startLength","endLength","ops"],a.isEqual(a.pick.apply(a,[this].concat(f.call(t))),a.pick.apply(a,[e].concat(f.call(t))))):!1},e.prototype.isIdentity=function(){var e,t,n,r,i;if(this.startLength===this.endLength){if(this.ops.length===0)return!0;e=0,i=this.ops;for(n=0,r=i.length;n<r;n++){t=i[n];if(!s.isRetain(t))return!1;if(t.start!==e)return!1;if(!(t.numAttributes()===0||t.numAttributes()===1&&a.has(t.attributes,"authorId")))return!1;e=t.end}return e!==this.endLength?!1:!0}return!1},e.prototype.isInsertsOnly=function(){return a.every(this.ops,function(t){return e.isInsert(t)})},e.prototype.normalize=function(){var e;return e=a.map(this.ops,function(e){switch(typeof e){case"string":return new r(e);case"number":return new s(e,e+1);case"object":if(e.value!=null)return new r(e.value,e.attributes);if(e.start!=null&&e.end!=null)return new s(e.start,e.end,e.attributes);break;default:return null}}),this.ops=a.reject(e,function(e){return e==null||e.getLength()===0})},e.prototype.toString=function(){return"{("+this.startLength+"->"+this.endLength+") ["+this.ops.join(", ")+"]}"},e}(),t.exports=n}).call(this)}),e.define("/node_modules/underscore/package.json",function(e,t,n,r,i,s,o){t.exports={main:"underscore.js"}}),e.define("/node_modules/underscore/underscore.js",function(e,t,n,r,i,s,o){(function(){var e=this,r=e._,i={},s=Array.prototype,o=Object.prototype,u=Function.prototype,a=s.push,f=s.slice,l=s.concat,c=o.toString,h=o.hasOwnProperty,p=s.forEach,d=s.map,v=s.reduce,m=s.reduceRight,g=s.filter,y=s.every,b=s.some,w=s.indexOf,E=s.lastIndexOf,S=Array.isArray,x=Object.keys,T=u.bind,N=function(e){if(e instanceof N)return e;if(!(this instanceof N))return new N(e);this._wrapped=e};typeof n!="undefined"?(typeof t!="undefined"&&t.exports&&(n=t.exports=N),n._=N):e._=N,N.VERSION="1.4.4";var C=N.each=N.forEach=function(e,t,n){if(e==null)return;if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,s=e.length;r<s;r++)if(t.call(n,e[r],r,e)===i)return}else for(var o in e)if(N.has(e,o)&&t.call(n,e[o],o,e)===i)return};N.map=N.collect=function(e,t,n){var r=[];return e==null?r:d&&e.map===d?e.map(t,n):(C(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var k="Reduce of empty array with no initial value";N.reduce=N.foldl=N.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduce===v)return r&&(t=N.bind(t,r)),i?e.reduce(t,n):e.reduce(t);C(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(k);return n},N.reduceRight=N.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(m&&e.reduceRight===m)return r&&(t=N.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=N.keys(e);s=o.length}C(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(k);return n},N.find=N.detect=function(e,t,n){var r;return L(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},N.filter=N.select=function(e,t,n){var r=[];return e==null?r:g&&e.filter===g?e.filter(t,n):(C(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},N.reject=function(e,t,n){return N.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},N.every=N.all=function(e,t,n){t||(t=N.identity);var r=!0;return e==null?r:y&&e.every===y?e.every(t,n):(C(e,function(e,s,o){if(!(r=r&&t.call(n,e,s,o)))return i}),!!r)};var L=N.some=N.any=function(e,t,n){t||(t=N.identity);var r=!1;return e==null?r:b&&e.some===b?e.some(t,n):(C(e,function(e,s,o){if(r||(r=t.call(n,e,s,o)))return i}),!!r)};N.contains=N.include=function(e,t){return e==null?!1:w&&e.indexOf===w?e.indexOf(t)!=-1:L(e,function(e){return e===t})},N.invoke=function(e,t){var n=f.call(arguments,2),r=N.isFunction(t);return N.map(e,function(e){return(r?t:e[t]).apply(e,n)})},N.pluck=function(e,t){return N.map(e,function(e){return e[t]})},N.where=function(e,t,n){return N.isEmpty(t)?n?null:[]:N[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},N.findWhere=function(e,t){return N.where(e,t,!0)},N.max=function(e,t,n){if(!t&&N.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&N.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return C(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},N.min=function(e,t,n){if(!t&&N.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&N.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return C(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},N.shuffle=function(e){var t,n=0,r=[];return C(e,function(e){t=N.random(n++),r[n-1]=r[t],r[t]=e}),r};var A=function(e){return N.isFunction(e)?e:function(t){return t[e]}};N.sortBy=function(e,t,n){var r=A(t);return N.pluck(N.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var O=function(e,t,n,r){var i={},s=A(t||N.identity);return C(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};N.groupBy=function(e,t,n){return O(e,t,n,function(e,t,n){(N.has(e,t)?e[t]:e[t]=[]).push(n)})},N.countBy=function(e,t,n){return O(e,t,n,function(e,t){N.has(e,t)||(e[t]=0),e[t]++})},N.sortedIndex=function(e,t,n,r){n=n==null?N.identity:A(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},N.toArray=function(e){return e?N.isArray(e)?f.call(e):e.length===+e.length?N.map(e,N.identity):N.values(e):[]},N.size=function(e){return e==null?0:e.length===+e.length?e.length:N.keys(e).length},N.first=N.head=N.take=function(e,t,n){return e==null?void 0:t!=null&&!n?f.call(e,0,t):e[0]},N.initial=function(e,t,n){return f.call(e,0,e.length-(t==null||n?1:t))},N.last=function(e,t,n){return e==null?void 0:t!=null&&!n?f.call(e,Math.max(e.length-t,0)):e[e.length-1]},N.rest=N.tail=N.drop=function(e,t,n){return f.call(e,t==null||n?1:t)},N.compact=function(e){return N.filter(e,N.identity)};var M=function(e,t,n){return C(e,function(e){N.isArray(e)?t?a.apply(n,e):M(e,t,n):n.push(e)}),n};N.flatten=function(e,t){return M(e,t,[])},N.without=function(e){return N.difference(e,f.call(arguments,1))},N.uniq=N.unique=function(e,t,n,r){N.isFunction(t)&&(r=n,n=t,t=!1);var i=n?N.map(e,n,r):e,s=[],o=[];return C(i,function(n,r){if(t?!r||o[o.length-1]!==n:!N.contains(o,n))o.push(n),s.push(e[r])}),s},N.union=function(){return N.uniq(l.apply(s,arguments))},N.intersection=function(e){var t=f.call(arguments,1);return N.filter(N.uniq(e),function(e){return N.every(t,function(t){return N.indexOf(t,e)>=0})})},N.difference=function(e){var t=l.apply(s,f.call(arguments,1));return N.filter(e,function(e){return!N.contains(t,e)})},N.zip=function(){var e=f.call(arguments),t=N.max(N.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=N.pluck(e,""+r);return n},N.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},N.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=N.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(w&&e.indexOf===w)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},N.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(E&&e.lastIndexOf===E)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},N.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},N.bind=function(e,t){if(e.bind===T&&T)return T.apply(e,f.call(arguments,1));var n=f.call(arguments,2);return function(){return e.apply(t,n.concat(f.call(arguments)))}},N.partial=function(e){var t=f.call(arguments,1);return function(){return e.apply(this,t.concat(f.call(arguments)))}},N.bindAll=function(e){var t=f.call(arguments,1);return t.length===0&&(t=N.functions(e)),C(t,function(t){e[t]=N.bind(e[t],e)}),e},N.memoize=function(e,t){var n={};return t||(t=N.identity),function(){var r=t.apply(this,arguments);return N.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},N.delay=function(e,t){var n=f.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},N.defer=function(e){return N.delay.apply(N,[e,1].concat(f.call(arguments,1)))},N.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},N.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},N.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},N.wrap=function(e,t){return function(){var n=[e];return a.apply(n,arguments),t.apply(this,n)}},N.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},N.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},N.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)N.has(e,n)&&(t[t.length]=n);return t},N.values=function(e){var t=[];for(var n in e)N.has(e,n)&&t.push(e[n]);return t},N.pairs=function(e){var t=[];for(var n in e)N.has(e,n)&&t.push([n,e[n]]);return t},N.invert=function(e){var t={};for(var n in e)N.has(e,n)&&(t[e[n]]=n);return t},N.functions=N.methods=function(e){var t=[];for(var n in e)N.isFunction(e[n])&&t.push(n);return t.sort()},N.extend=function(e){return C(f.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},N.pick=function(e){var t={},n=l.apply(s,f.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},N.omit=function(e){var t={},n=l.apply(s,f.call(arguments,1));for(var r in e)N.contains(n,r)||(t[r]=e[r]);return t},N.defaults=function(e){return C(f.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},N.clone=function(e){return N.isObject(e)?N.isArray(e)?e.slice():N.extend({},e):e},N.tap=function(e,t){return t(e),e};var _=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof N&&(e=e._wrapped),t instanceof N&&(t=t._wrapped);var i=c.call(e);if(i!=c.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=_(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(N.isFunction(a)&&a instanceof a&&N.isFunction(f)&&f instanceof f))return!1;for(var l in e)if(N.has(e,l)){o++;if(!(u=N.has(t,l)&&_(e[l],t[l],n,r)))break}if(u){for(l in t)if(N.has(t,l)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};N.isEqual=function(e,t){return _(e,t,[],[])},N.isEmpty=function(e){if(e==null)return!0;if(N.isArray(e)||N.isString(e))return e.length===0;for(var t in e)if(N.has(e,t))return!1;return!0},N.isElement=function(e){return!!e&&e.nodeType===1},N.isArray=S||function(e){return c.call(e)=="[object Array]"},N.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){N["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),N.isArguments(arguments)||(N.isArguments=function(e){return!!e&&!!N.has(e,"callee")}),typeof /./!="function"&&(N.isFunction=function(e){return typeof e=="function"}),N.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},N.isNaN=function(e){return N.isNumber(e)&&e!=+e},N.isBoolean=function(e){return e===!0||e===!1||c.call(e)=="[object Boolean]"},N.isNull=function(e){return e===null},N.isUndefined=function(e){return e===void 0},N.has=function(e,t){return h.call(e,t)},N.noConflict=function(){return e._=r,this},N.identity=function(e){return e},N.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},N.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};D.unescape=N.invert(D.escape);var P={escape:new RegExp("["+N.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+N.keys(D.unescape).join("|")+")","g")};N.each(["escape","unescape"],function(e){N[e]=function(t){return t==null?"":(""+t).replace(P[e],function(t){return D[e][t]})}}),N.result=function(e,t){if(e==null)return null;var n=e[t];return N.isFunction(n)?n.call(e):n},N.mixin=function(e){C(N.functions(e),function(t){var n=N[t]=e[t];N.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),I.call(this,n.apply(N,e))}})};var H=0;N.uniqueId=function(e){var t=++H+"";return e?e+t:t},N.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\t|\u2028|\u2029/g;N.template=function(e,t,n){var r;n=N.defaults({},n,N.templateSettings);var i=new RegExp([(n.escape||B).source,(n.interpolate||B).source,(n.evaluate||B).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(F,function(e){return"\\"+j[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,N);var a=function(e){return r.call(this,e,N)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},N.chain=function(e){return N(e).chain()};var I=function(e){return this._chain?N(e).chain():e};N.mixin(N),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];N.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],I.call(this,n)}}),C(["concat","join","slice"],function(e){var t=s[e];N.prototype[e]=function(){return I.call(this,t.apply(this._wrapped,arguments))}}),N.extend(N.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)}),e.define("/node_modules/googlediff/package.json",function(e,t,n,r,i,s,o){t.exports={}}),e.define("/node_modules/googlediff/index.js",function(e,t,n,r,i,s,o){t.exports=e("./javascript/diff_match_patch_uncompressed.js").diff_match_patch}),e.define("/node_modules/googlediff/javascript/diff_match_patch_uncompressed.js",function(e,t,n,r,i,s,o){function u(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var a=-1,f=1,l=0;u.Diff,u.prototype.diff_main=function(e,t,n,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=(new Date).getTime()+this.Diff_Timeout*1e3);var i=r;if(e==null||t==null)throw new Error("Null input. (diff_main)");if(e==t)return e?[[l,e]]:[];typeof n=="undefined"&&(n=!0);var s=n,o=this.diff_commonPrefix(e,t),u=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var a=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var f=this.diff_compute_(e,t,s,i);return u&&f.unshift([l,u]),a&&f.push([l,a]),this.diff_cleanupMerge(f),f},u.prototype.diff_compute_=function(e,t,n,r){var i;if(!e)return[[f,t]];if(!t)return[[a,e]];var s=e.length>t.length?e:t,o=e.length>t.length?t:e,u=s.indexOf(o);if(u!=-1)return i=[[f,s.substring(0,u)],[l,o],[f,s.substring(u+o.length)]],e.length>t.length&&(i[0][0]=i[2][0]=a),i;if(o.length==1)return[[a,e],[f,t]];var c=this.diff_halfMatch_(e,t);if(c){var h=c[0],p=c[1],d=c[2],v=c[3],m=c[4],g=this.diff_main(h,d,n,r),y=this.diff_main(p,v,n,r);return g.concat([[l,m]],y)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)},u.prototype.diff_lineMode_=function(e,t,n){var r=this.diff_linesToChars_(e,t);e=r.chars1,t=r.chars2;var i=r.lineArray,s=this.diff_main(e,t,!1,n);this.diff_charsToLines_(s,i),this.diff_cleanupSemantic(s),s.push([l,""]);var o=0,u=0,c=0,h="",p="";while(o<s.length){switch(s[o][0]){case f:c++,p+=s[o][1];break;case a:u++,h+=s[o][1];break;case l:if(u>=1&&c>=1){s.splice(o-u-c,u+c),o=o-u-c;var r=this.diff_main(h,p,!1,n);for(var d=r.length-1;d>=0;d--)s.splice(o,0,r[d]);o+=r.length}c=0,u=0,h="",p=""}o++}return s.pop(),s},u.prototype.diff_bisect_=function(e,t,n){var r=e.length,i=t.length,s=Math.ceil((r+i)/2),o=s,u=2*s,l=new Array(u),c=new Array(u);for(var h=0;h<u;h++)l[h]=-1,c[h]=-1;l[o+1]=0,c[o+1]=0;var p=r-i,d=p%2!=0,v=0,m=0,g=0,y=0;for(var b=0;b<s;b++){if((new Date).getTime()>n)break;for(var w=-b+v;w<=b-m;w+=2){var E=o+w,S;w==-b||w!=b&&l[E-1]<l[E+1]?S=l[E+1]:S=l[E-1]+1;var x=S-w;while(S<r&&x<i&&e.charAt(S)==t.charAt(x))S++,x++;l[E]=S;if(S>r)m+=2;else if(x>i)v+=2;else if(d){var T=o+p-w;if(T>=0&&T<u&&c[T]!=-1){var N=r-c[T];if(S>=N)return this.diff_bisectSplit_(e,t,S,x,n)}}}for(var C=-b+g;C<=b-y;C+=2){var T=o+C,N;C==-b||C!=b&&c[T-1]<c[T+1]?N=c[T+1]:N=c[T-1]+1;var k=N-C;while(N<r&&k<i&&e.charAt(r-N-1)==t.charAt(i-k-1))N++,k++;c[T]=N;if(N>r)y+=2;else if(k>i)g+=2;else if(!d){var E=o+p-C;if(E>=0&&E<u&&l[E]!=-1){var S=l[E],x=o+S-E;N=r-N;if(S>=N)return this.diff_bisectSplit_(e,t,S,x,n)}}}}return[[a,e],[f,t]]},u.prototype.diff_bisectSplit_=function(e,t,n,r,i){var s=e.substring(0,n),o=t.substring(0,r),u=e.substring(n),a=t.substring(r),f=this.diff_main(s,o,!1,i),l=this.diff_main(u,a,!1,i);return f.concat(l)},u.prototype.diff_linesToChars_=function(e,t){function i(e){var t="",i=0,s=-1,o=n.length;while(s<e.length-1){s=e.indexOf("\n",i),s==-1&&(s=e.length-1);var u=e.substring(i,s+1);i=s+1,(r.hasOwnProperty?r.hasOwnProperty(u):r[u]!==undefined)?t+=String.fromCharCode(r[u]):(t+=String.fromCharCode(o),r[u]=o,n[o++]=u)}return t}var n=[],r={};n[0]="";var s=i(e),o=i(t);return{chars1:s,chars2:o,lineArray:n}},u.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){var r=e[n][1],i=[];for(var s=0;s<r.length;s++)i[s]=t[r.charCodeAt(s)];e[n][1]=i.join("")}},u.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;var n=0,r=Math.min(e.length,t.length),i=r,s=0;while(n<i)e.substring(s,i)==t.substring(s,i)?(n=i,s=n):r=i,i=Math.floor((r-n)/2+n);return i},u.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;var n=0,r=Math.min(e.length,t.length),i=r,s=0;while(n<i)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?(n=i,s=n):r=i,i=Math.floor((r-n)/2+n);return i},u.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(n==0||r==0)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;var s=0,o=1;for(;;){var u=e.substring(i-o),a=t.indexOf(u);if(a==-1)return s;o+=a;if(a==0||e.substring(i-o)==t.substring(0,o))s=o,o++}},u.prototype.diff_halfMatch_=function(e,t){function s(e,t,n){var r=e.substring(n,n+Math.floor(e.length/4)),s=-1,o="",u,a,f,l;while((s=t.indexOf(r,s+1))!=-1){var c=i.diff_commonPrefix(e.substring(n),t.substring(s)),h=i.diff_commonSuffix(e.substring(0,n),t.substring(0,s));o.length<h+c&&(o=t.substring(s-h,s)+t.substring(s,s+c),u=e.substring(0,n-h),a=e.substring(n+c),f=t.substring(0,s-h),l=t.substring(s+c))}return o.length*2>=e.length?[u,a,f,l,o]:null}if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||r.length*2<n.length)return null;var i=this,o=s(n,r,Math.ceil(n.length/4)),u=s(n,r,Math.ceil(n.length/2)),a;if(!o&&!u)return null;u?o?a=o[4].length>u[4].length?o:u:a=u:a=o;var f,l,c,h;e.length>t.length?(f=a[0],l=a[1],c=a[2],h=a[3]):(c=a[0],h=a[1],f=a[2],l=a[3]);var p=a[4];return[f,l,c,h,p]},u.prototype.diff_cleanupSemantic=function(e){var t=!1,n=[],r=0,i=null,s=0,o=0,u=0,c=0,h=0;while(s<e.length)e[s][0]==l?(n[r++]=s,o=c,u=h,c=0,h=0,i=e[s][1]):(e[s][0]==f?c+=e[s][1].length:h+=e[s][1].length,i&&i.length<=Math.max(o,u)&&i.length<=Math.max(c,h)&&(e.splice(n[r-1],0,[a,i]),e[n[r-1]+1][0]=f,r--,r--,s=r>0?n[r-1]:-1,o=0,u=0,c=0,h=0,i=null,t=!0)),s++;t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),s=1;while(s<e.length){if(e[s-1][0]==a&&e[s][0]==f){var p=e[s-1][1],d=e[s][1],v=this.diff_commonOverlap_(p,d),m=this.diff_commonOverlap_(d,p);if(v>=m){if(v>=p.length/2||v>=d.length/2)e.splice(s,0,[l,d.substring(0,v)]),e[s-1][1]=p.substring(0,p.length-v),e[s+1][1]=d.substring(v),s++}else if(m>=p.length/2||m>=d.length/2)e.splice(s,0,[l,p.substring(0,m)]),e[s-1][0]=f,e[s-1][1]=d.substring(0,d.length-m),e[s+1][0]=a,e[s+1][1]=p.substring(m),s++;s++}s++}},u.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),i=n.match(u.nonAlphaNumericRegex_),s=r.match(u.nonAlphaNumericRegex_),o=i&&n.match(u.whitespaceRegex_),a=s&&r.match(u.whitespaceRegex_),f=o&&n.match(u.linebreakRegex_),l=a&&r.match(u.linebreakRegex_),c=f&&e.match(u.blanklineEndRegex_),h=l&&t.match(u.blanklineStartRegex_);return c||h?5:f||l?4:i&&!o&&a?3:o||a?2:i||s?1:0}var n=1;while(n<e.length-1){if(e[n-1][0]==l&&e[n+1][0]==l){var r=e[n-1][1],i=e[n][1],s=e[n+1][1],o=this.diff_commonSuffix(r,i);if(o){var a=i.substring(i.length-o);r=r.substring(0,r.length-o),i=a+i.substring(0,i.length-o),s=a+s}var f=r,c=i,h=s,p=t(r,i)+t(i,s);while(i.charAt(0)===s.charAt(0)){r+=i.charAt(0),i=i.substring(1)+s.charAt(0),s=s.substring(1);var d=t(r,i)+t(i,s);d>=p&&(p=d,f=r,c=i,h=s)}e[n-1][1]!=f&&(f?e[n-1][1]=f:(e.splice(n-1,1),n--),e[n][1]=c,h?e[n+1][1]=h:(e.splice(n+1,1),n--))}n++}},u.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,u.whitespaceRegex_=/\s/,u.linebreakRegex_=/[\r\n]/,u.blanklineEndRegex_=/\n\r?\n$/,u.blanklineStartRegex_=/^\r?\n\r?\n/,u.prototype.diff_cleanupEfficiency=function(e){var t=!1,n=[],r=0,i=null,s=0,o=!1,u=!1,c=!1,h=!1;while(s<e.length)e[s][0]==l?(e[s][1].length<this.Diff_EditCost&&(c||h)?(n[r++]=s,o=c,u=h,i=e[s][1]):(r=0,i=null),c=h=!1):(e[s][0]==a?h=!0:c=!0,i&&(o&&u&&c&&h||i.length<this.Diff_EditCost/2&&o+u+c+h==3)&&(e.splice(n[r-1],0,[a,i]),e[n[r-1]+1][0]=f,r--,i=null,o&&u?(c=h=!0,r=0):(r--,s=r>0?n[r-1]:-1,c=h=!1),t=!0)),s++;t&&this.diff_cleanupMerge(e)},u.prototype.diff_cleanupMerge=function(e){e.push([l,""]);var t=0,n=0,r=0,i="",s="",o;while(t<e.length)switch(e[t][0]){case f:r++,s+=e[t][1],t++;break;case a:n++,i+=e[t][1],t++;break;case l:n+r>1?(n!==0&&r!==0&&(o=this.diff_commonPrefix(s,i),o!==0&&(t-n-r>0&&e[t-n-r-1][0]==l?e[t-n-r-1][1]+=s.substring(0,o):(e.splice(0,0,[l,s.substring(0,o)]),t++),s=s.substring(o),i=i.substring(o)),o=this.diff_commonSuffix(s,i),o!==0&&(e[t][1]=s.substring(s.length-o)+e[t][1],s=s.substring(0,s.length-o),i=i.substring(0,i.length-o))),n===0?e.splice(t-r,n+r,[f,s]):r===0?e.splice(t-n,n+r,[a,i]):e.splice(t-n-r,n+r,[a,i],[f,s]),t=t-n-r+(n?1:0)+(r?1:0)+1):t!==0&&e[t-1][0]==l?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,r=0,n=0,i="",s=""}e[e.length-1][1]===""&&e.pop();var u=!1;t=1;while(t<e.length-1)e[t-1][0]==l&&e[t+1][0]==l&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)==e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),u=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),u=!0)),t++;u&&this.diff_cleanupMerge(e)},u.prototype.diff_xIndex=function(e,t){var n=0,r=0,i=0,s=0,o;for(o=0;o<e.length;o++){e[o][0]!==f&&(n+=e[o][1].length),e[o][0]!==a&&(r+=e[o][1].length);if(n>t)break;i=n,s=r}return e.length!=o&&e[o][0]===a?s:s+(t-i)},u.prototype.diff_prettyHtml=function(e){var t=[],n=/&/g,r=/</g,i=/>/g,s=/\n/g;for(var o=0;o<e.length;o++){var u=e[o][0],c=e[o][1],h=c.replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(s,"&para;<br>");switch(u){case f:t[o]='<ins style="background:#e6ffe6;">'+h+"</ins>";break;case a:t[o]='<del style="background:#ffe6e6;">'+h+"</del>";break;case l:t[o]="<span>"+h+"</span>"}}return t.join("")},u.prototype.diff_text1=function(e){var t=[];for(var n=0;n<e.length;n++)e[n][0]!==f&&(t[n]=e[n][1]);return t.join("")},u.prototype.diff_text2=function(e){var t=[];for(var n=0;n<e.length;n++)e[n][0]!==a&&(t[n]=e[n][1]);return t.join("")},u.prototype.diff_levenshtein=function(e){var t=0,n=0,r=0;for(var i=0;i<e.length;i++){var s=e[i][0],o=e[i][1];switch(s){case f:n+=o.length;break;case a:r+=o.length;break;case l:t+=Math.max(n,r),n=0,r=0}}return t+=Math.max(n,r),t},u.prototype.diff_toDelta=function(e){var t=[];for(var n=0;n<e.length;n++)switch(e[n][0]){case f:t[n]="+"+encodeURI(e[n][1]);break;case a:t[n]="-"+e[n][1].length;break;case l:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},u.prototype.diff_fromDelta=function(e,t){var n=[],r=0,i=0,s=t.split(/\t/g);for(var o=0;o<s.length;o++){var u=s[o].substring(1);switch(s[o].charAt(0)){case"+":try{n[r++]=[f,decodeURI(u)]}catch(c){throw new Error("Illegal escape in diff_fromDelta: "+u)}break;case"-":case"=":var h=parseInt(u,10);if(isNaN(h)||h<0)throw new Error("Invalid number in diff_fromDelta: "+u);var p=e.substring(i,i+=h);s[o].charAt(0)=="="?n[r++]=[l,p]:n[r++]=[a,p];break;default:if(s[o])throw new Error("Invalid diff operation in diff_fromDelta: "+s[o])}}if(i!=e.length)throw new Error("Delta length ("+i+") does not equal source text length ("+e.length+").");return n},u.prototype.match_main=function(e,t,n){if(e==null||t==null||n==null)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},u.prototype.match_bitap_=function(e,t,n){function s(e,r){var s=e/t.length,o=Math.abs(n-r);return i.Match_Distance?s+o/i.Match_Distance:o?1:s}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(t),i=this,o=this.Match_Threshold,u=e.indexOf(t,n);u!=-1&&(o=Math.min(s(0,u),o),u=e.lastIndexOf(t,n+t.length),u!=-1&&(o=Math.min(s(0,u),o)));var a=1<<t.length-1;u=-1;var f,l,c=t.length+e.length,h;for(var p=0;p<t.length;p++){f=0,l=c;while(f<l)s(p,n+l)<=o?f=l:c=l,l=Math.floor((c-f)/2+f);c=l;var d=Math.max(1,n-l+1),v=Math.min(n+l,e.length)+t.length,m=Array(v+2);m[v+1]=(1<<p)-1;for(var g=v;g>=d;g--){var y=r[e.charAt(g-1)];p===0?m[g]=(m[g+1]<<1|1)&y:m[g]=(m[g+1]<<1|1)&y|((h[g+1]|h[g])<<1|1)|h[g+1];if(m[g]&a){var b=s(p,g-1);if(b<=o){o=b,u=g-1;if(!(u>n))break;d=Math.max(1,2*n-u)}}}if(s(p+1,n)>o)break;h=m}return u},u.prototype.match_alphabet_=function(e){var t={};for(var n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},u.prototype.patch_addContext_=function(e,t){if(t.length==0)return;var n=t.substring(e.start2,e.start2+e.length1),r=0;while(t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin)r+=this.Patch_Margin,n=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var i=t.substring(e.start2-r,e.start2);i&&e.diffs.unshift([l,i]);var s=t.substring(e.start2+e.length1,e.start2+e.length1+r);s&&e.diffs.push([l,s]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+s.length,e.length2+=i.length+s.length},u.prototype.patch_make=function(e,t,n){var r,i;if(typeof e=="string"&&typeof t=="string"&&typeof n=="undefined")r=e,i=this.diff_main(r,t,!0),i.length>2&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(e&&typeof e=="object"&&typeof t=="undefined"&&typeof n=="undefined")i=e,r=this.diff_text1(i);else if(typeof e=="string"&&t&&typeof t=="object"&&typeof n=="undefined")r=e,i=t;else{if(typeof e!="string"||typeof t!="string"||!n||typeof n!="object")throw new Error("Unknown call format to patch_make.");r=e,i=n}if(i.length===0)return[];var s=[],o=new u.patch_obj,c=0,h=0,p=0,d=r,v=r;for(var m=0;m<i.length;m++){var g=i[m][0],y=i[m][1];!c&&g!==l&&(o.start1=h,o.start2=p);switch(g){case f:o.diffs[c++]=i[m],o.length2+=y.length,v=v.substring(0,p)+y+v.substring(p);break;case a:o.length1+=y.length,o.diffs[c++]=i[m],v=v.substring(0,p)+v.substring(p+y.length);break;case l:y.length<=2*this.Patch_Margin&&c&&i.length!=m+1?(o.diffs[c++]=i[m],o.length1+=y.length,o.length2+=y.length):y.length>=2*this.Patch_Margin&&c&&(this.patch_addContext_(o,d),s.push(o),o=new u.patch_obj,c=0,d=v,h=p)}g!==f&&(h+=y.length),g!==a&&(p+=y.length)}return c&&(this.patch_addContext_(o,d),s.push(o)),s},u.prototype.patch_deepCopy=function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=new u.patch_obj;i.diffs=[];for(var s=0;s<r.diffs.length;s++)i.diffs[s]=r.diffs[s].slice();i.start1=r.start1,i.start2=r.start2,i.length1=r.length1,i.length2=r.length2,t[n]=i}return t},u.prototype.patch_apply=function(e,t){if(e.length==0)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);var r=0,i=[];for(var s=0;s<e.length;s++){var o=e[s].start2+r,u=this.diff_text1(e[s].diffs),c,h=-1;if(u.length>this.Match_MaxBits){c=this.match_main(t,u.substring(0,this.Match_MaxBits),o);if(c!=-1){h=this.match_main(t,u.substring(u.length-this.Match_MaxBits),o+u.length-this.Match_MaxBits);if(h==-1||c>=h)c=-1}}else c=this.match_main(t,u,o);if(c==-1)i[s]=!1,r-=e[s].length2-e[s].length1;else{i[s]=!0,r=c-o;var p;h==-1?p=t.substring(c,c+u.length):p=t.substring(c,h+this.Match_MaxBits);if(u==p)t=t.substring(0,c)+this.diff_text2(e[s].diffs)+t.substring(c+u.length);else{var d=this.diff_main(u,p,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(d)/u.length>this.Patch_DeleteThreshold)i[s]=!1;else{this.diff_cleanupSemanticLossless(d);var v=0,m;for(var g=0;g<e[s].diffs.length;g++){var y=e[s].diffs[g];y[0]!==l&&(m=this.diff_xIndex(d,v)),y[0]===f?t=t.substring(0,c+m)+y[1]+t.substring(c+m):y[0]===a&&(t=t.substring(0,c+m)+t.substring(c+this.diff_xIndex(d,v+y[1].length))),y[0]!==a&&(v+=y[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,i]},u.prototype.patch_addPadding=function(e){var t=this.Patch_Margin,n="";for(var r=1;r<=t;r++)n+=String.fromCharCode(r);for(var r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var i=e[0],s=i.diffs;if(s.length==0||s[0][0]!=l)s.unshift([l,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>s[0][1].length){var o=t-s[0][1].length;s[0][1]=n.substring(s[0][1].length)+s[0][1],i.start1-=o,i.start2-=o,i.length1+=o,i.length2+=o}i=e[e.length-1],s=i.diffs;if(s.length==0||s[s.length-1][0]!=l)s.push([l,n]),i.length1+=t,i.length2+=t;else if(t>s[s.length-1][1].length){var o=t-s[s.length-1][1].length;s[s.length-1][1]+=n.substring(0,o),i.length1+=o,i.length2+=o}return n},u.prototype.patch_splitMax=function(e){var t=this.Match_MaxBits;for(var n=0;n<e.length;n++){if(e[n].length1<=t)continue;var r=e[n];e.splice(n--,1);var i=r.start1,s=r.start2,o="";while(r.diffs.length!==0){var c=new u.patch_obj,h=!0;c.start1=i-o.length,c.start2=s-o.length,o!==""&&(c.length1=c.length2=o.length,c.diffs.push([l,o]));while(r.diffs.length!==0&&c.length1<t-this.Patch_Margin){var p=r.diffs[0][0],d=r.diffs[0][1];p===f?(c.length2+=d.length,s+=d.length,c.diffs.push(r.diffs.shift()),h=!1):p===a&&c.diffs.length==1&&c.diffs[0][0]==l&&d.length>2*t?(c.length1+=d.length,i+=d.length,h=!1,c.diffs.push([p,d]),r.diffs.shift()):(d=d.substring(0,t-c.length1-this.Patch_Margin),c.length1+=d.length,i+=d.length,p===l?(c.length2+=d.length,s+=d.length):h=!1,c.diffs.push([p,d]),d==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(d.length))}o=this.diff_text2(c.diffs),o=o.substring(o.length-this.Patch_Margin);var v=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);v!==""&&(c.length1+=v.length,c.length2+=v.length,c.diffs.length!==0&&c.diffs[c.diffs.length-1][0]===l?c.diffs[c.diffs.length-1][1]+=v:c.diffs.push([l,v])),h||e.splice(++n,0,c)}}},u.prototype.patch_toText=function(e){var t=[];for(var n=0;n<e.length;n++)t[n]=e[n];return t.join("")},u.prototype.patch_fromText=function(e){var t=[];if(!e)return t;var n=e.split("\n"),r=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;while(r<n.length){var s=n[r].match(i);if(!s)throw new Error("Invalid patch string: "+n[r]);var o=new u.patch_obj;t.push(o),o.start1=parseInt(s[1],10),s[2]===""?(o.start1--,o.length1=1):s[2]=="0"?o.length1=0:(o.start1--,o.length1=parseInt(s[2],10)),o.start2=parseInt(s[3],10),s[4]===""?(o.start2--,o.length2=1):s[4]=="0"?o.length2=0:(o.start2--,o.length2=parseInt(s[4],10)),r++;while(r<n.length){var c=n[r].charAt(0);try{var h=decodeURI(n[r].substring(1))}catch(p){throw new Error("Illegal escape in patch_fromText: "+h)}if(c=="-")o.diffs.push([a,h]);else if(c=="+")o.diffs.push([f,h]);else if(c==" ")o.diffs.push([l,h]);else{if(c=="@")break;if(c!=="")throw new Error('Invalid patch mode "'+c+'" in: '+h)}r++}}return t},u.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},u.patch_obj.prototype.toString=function(){var e,t;this.length1===0?e=this.start1+",0":this.length1==1?e=this.start1+1:e=this.start1+1+","+this.length1,this.length2===0?t=this.start2+",0":this.length2==1?t=this.start2+1:t=this.start2+1+","+this.length2;var n=["@@ -"+e+" +"+t+" @@\n"],r;for(var i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case f:r="+";break;case a:r="-";break;case l:r=" "}n[i+1]=r+encodeURI(this.diffs[i][1])+"\n"}return n.join("").replace(/%20/g," ")},this.diff_match_patch=u,this.DIFF_DELETE=a,this.DIFF_INSERT=f,this.DIFF_EQUAL=l}),e.define("/src/core/op.coffee",function(e,t,n,r,i,s,o){(function(){var n,r,i;typeof t!="undefined"&&t!==null&&(i=e("underscore")._),r=function(e){return e!=null&&typeof e.value=="string"},n=function(){function e(e){e==null&&(e={}),this.attributes=i.clone(e)}return e.prototype.addAttributes=function(e){var t,n,r;t={};for(n in e)r=e[n],this.attributes[n]===void 0&&(t[n]=r);return t},e.prototype.attributesMatch=function(e){var t;return t=e.attributes||{},i.isEqual(this.attributes,t)},e.prototype.composeAttributes=function(e){var t,n;return n=this,t=function(e,s){var o,u,a;if(!s)return e;u=i.clone(e);for(o in s)a=s[o],r(n)&&a===null?delete u[o]:typeof a!="undefined"&&(typeof u[o]=="object"&&typeof a=="object"&&i.all([u[o],s[o]],function(e){return e!==null})?u[o]=t(u[o],a):u[o]=a);return u},t(this.attributes,e)},e.prototype.numAttributes=function(){return i.keys(this.attributes).length},e.prototype.printAttributes=function(){return JSON.stringify(this.attributes)},e}(),t.exports=n}).call(this)}),e.define("/src/core/insert.coffee",function(e,t,n,r,i,s,o){(function(){var n,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};typeof t!="undefined"&&t!==null&&(i=e("underscore")._),r=e("./op"),n=function(e){function t(e,t){this.value=e,t==null&&(t={}),this.attributes=i.clone(t)}return o(t,e),t.copy=function(e){return new t(e.value,e.attributes)},t.isInsert=function(e){return e!=null&&typeof e.value=="string"},t.prototype.getAt=function(e,n){return new t(this.value.substr(e,n),this.attributes)},t.prototype.getLength=function(){return this.value.length},t.prototype.join=function(e){if(i.isEqual(this.attributes,e.attributes))return new t(this.value+second.value,this.attributes);throw Error},t.prototype.split=function(e){var n,r;return console.assert(e<=this.value.length,"Split called with offset beyond end of insert"),n=new t(this.value.substr(0,e),this.attributes),r=new t(this.value.substr(e),this.attributes),[n,r]},t.prototype.toString=function(){return"{"+this.value+", "+this.printAttributes()+"}"},t}(r),t.exports=n}).call(this)}),e.define("/src/core/retain.coffee",function(e,t,n,r,i,s,o){(function(){var n,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};typeof t!="undefined"&&t!==null&&(i=e("underscore")._),n=e("./op"),r=function(e){function t(e,t,n){this.start=e,this.end=t,n==null&&(n={}),console.assert(this.start>=0,"RetainOp start cannot be negative!",this.start),console.assert(this.end>=this.start,"RetainOp end must be >= start!",this.start,this.end),this.attributes=i.clone(n)}return o(t,e),t.copy=function(e){return console.assert(t.isRetain(e),"Copy called on non-retain",e),new t(e.start,e.end,e.attributes)},t.isRetain=function(e){return e!=null&&typeof e.start=="number"&&typeof e.end=="number"},t.prototype.getAt=function(e,n){return new t(this.start+e,this.start+e+n,this.attributes)},t.prototype.getLength=function(){return this.end-this.start},t.prototype.split=function(e){var n,r;return console.assert(e<=this.end,"Split called with offset beyond end of retain"),n=new t(this.start,this.start+e,this.attributes),r=new t(this.start+e,this.end,this.attributes),[n,r]},t.prototype.toString=function(){return"{{"+this.start+" - "+this.end+"), "+this.printAttributes()+"}"},t}(n),t.exports=r}).call(this)}),e.define("/src/client/tandem-core.coffee",function(e,t,n,r,i,s,o){(function(){var t,n,r,i;t=e("../core/delta"),r=e("../core/op"),n=e("../core/insert"),i=e("../core/retain"),window.Tandem==null&&(window.Tandem={Delta:t,Op:r,InsertOp:n,RetainOp:i})}).call(this)}),e("/src/client/tandem-core.coffee")}(),window.rangy=function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function m(e,t){t?window.alert(e):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(e)}function g(e){v.initialized=!0,v.supported=!1,m("Rangy is not supported on this page in your browser. Reason: "+e,v.config.alertOnFail)}function y(e){m("Rangy warning: "+e,v.config.alertOnWarn)}function E(){if(v.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0),e.detach());var s=a(document,"body")?document.body:document.getElementsByTagName("body")[0];if(!s||s.nodeName.toLowerCase()!="body"){g("No body element found");return}s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0));if(!t&&!n){g("Neither Range nor TextRange are available");return}v.initialized=!0,v.features={implementsDomRange:t,implementsTextRange:n};var o=w.concat(b);for(var f=0,l=o.length;f<l;++f)try{o[f](v)}catch(h){a(window,"console")&&u(window.console,"log")&&window.console.log("Rangy init listener threw an exception. Continuing.",h)}}function x(e){e=e||window,E();for(var t=0,n=S.length;t<n;++t)S[t](e)}function T(e){this.name=e,this.initialized=!1,this.supported=!1}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),v={version:"1.3alpha.681",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d},features:{},modules:{},config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};v.fail=g,v.warn=y,{}.hasOwnProperty?v.util.extend=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&v.util.extend(r,i,!0),e[s]=i);return e}:g("hasOwnProperty not supported");var b=[],w=[];v.init=E,v.addInitListener=function(e){v.initialized?e(v):b.push(e)};var S=[];v.addCreateMissingNativeApiListener=function(e){S.push(e)},v.createMissingNativeApi=x,T.prototype={fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){v.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){v.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},v.createModule=function(e,t){var n=new T(e);v.modules[e]=n,w.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},v.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=v.modules[i];if(!r||!(r instanceof T))throw new Error("Module '"+i+"' not found");if(!r.supported)throw new Error("Module '"+i+"' not supported")}};var N=!1,C=function(e){N||(N=!0,v.initialized||E())};if(typeof window==n){g("No window found");return}if(typeof document==n){g("No document found");return}return u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",C,!1),u(window,"addEventListener")?window.addEventListener("load",C,!1):u(window,"attachEvent")?window.attachEvent("onload",C):g("Window does not have required addEventListener or attachEvent method"),v}(),rangy.createModule("DomUtil",function(e,t){function u(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function a(e){var t=e.parentNode;return t.nodeType==1?t:null}function f(e){var t=0;while(e=e.previousSibling)t++;return t}function l(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function c(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function p(e,t){return h(e,t,!0)}function d(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null}function v(e){var t=e.nodeType;return t==3||t==4||t==8}function m(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function g(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function y(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),g(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>f(e)&&++s.offset;return r}function b(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return b(e.parentNode);throw t.createError("getDocument: no document found for node")}function w(e){var r=b(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function E(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function S(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function x(e){return r.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function T(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function N(e){var t;return e?r.isHostProperty(e,"nodeType")?t=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?E(e):b(e):T(e)&&(t=e.document):t=document,t}function C(e){var t;while(t=e.parentNode)e=t;return e}function k(e,n,r,i){var s,o,u,a,l;if(e==r)return n===i?0:n<i?-1:1;if(s=d(r,e,!0))return n<=f(s)?-1:1;if(s=d(e,r,!0))return f(s)<i?-1:1;o=c(e,r),u=e===o?o:d(e,o,!0),a=r===o?o:d(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");l=o.firstChild;while(l){if(l===u)return-1;if(l===a)return 1;l=l.nextSibling}}function L(e){if(!e)return"[No node]";if(v(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function A(e){var t=b(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function O(e){this.root=e,this._next=e}function M(e){return new O(e)}function _(e,t){this.node=e,this.offset=t}function D(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var i=document.createElement("div");r.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(i,"innerHTML")||t.fail("Element is missing innerHTML property");var s=document.createTextNode("test");r.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(s,["data"]))||t.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1};O.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},_.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+L(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},e.dom={arrayContains:o,isHtmlNamespace:u,parentElement:a,getNodeIndex:f,getNodeLength:l,getCommonAncestor:c,isAncestorOf:h,isOrIsAncestorOf:p,getClosestAncestorIn:d,isCharacterDataNode:v,isTextOrCommentNode:m,insertAfter:g,splitDataNode:y,getDocument:b,getWindow:w,getIframeWindow:S,getIframeDocument:E,getBody:x,isWindow:T,getContentDocument:N,getRootContainer:C,comparePoints:k,inspectNode:L,fragmentFromNodeChildren:A,createIterator:M,DomPosition:_},e.DOMException=D}),rangy.createModule("DomRange",function(e,t){function o(e,t){return e.nodeType!=3&&(n.isOrIsAncestorOf(e,t.startContainer)||n.isOrIsAncestorOf(e,t.endContainer))}function u(e){return n.getDocument(e.startContainer)}function a(e){return new i(e.parentNode,n.getNodeIndex(e))}function f(e){return new i(e.parentNode,n.getNodeIndex(e)+1)}function l(e,t,r){var i=e.nodeType==11?e.firstChild:e;return n.isCharacterDataNode(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:n.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function c(e,t,r){q(e),q(t);if(u(t)!=u(e))throw new s("WRONG_DOCUMENT_ERR");var i=n.comparePoints(e.startContainer,e.startOffset,t.endContainer,t.endOffset),o=n.comparePoints(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?i<=0&&o>=0:i<0&&o>0}function h(e){var t;for(var n,r=u(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(h(i)),i.detach(!0));if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function p(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),p(u,t,r),u.detach(!0);if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function d(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function v(e){for(var t,n=u(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(v(r)),r.detach(!0)):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function m(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var o=[];return p(new y(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function g(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function y(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var r=e.commonAncestorContainer;this.sc===this.ec&&n.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!n.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:n.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!n.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:n.getClosestAncestorIn(this.ec,r,!0))}}function b(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function N(e){return function(t,r){var i,s=r?t:t.parentNode;while(s){i=s.nodeType;if(n.arrayContains(e,i))return s;s=s.parentNode}return null}}function O(e,t){if(A(e,t))throw new b("INVALID_NODE_TYPE_ERR")}function M(e){if(!e.startContainer)throw new s("INVALID_STATE_ERR")}function _(e,t){if(!n.arrayContains(t,e.nodeType))throw new b("INVALID_NODE_TYPE_ERR")}function D(e,t){if(t<0||t>(n.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function P(e,t){if(k(e,!0)!==k(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function H(e){if(L(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function B(e,t){if(!e)throw new s(t)}function j(e){return!n.arrayContains(E,e.nodeType)&&!k(e,!0)}function F(e,t){return t<=(n.isCharacterDataNode(e)?e.length:e.childNodes.length)}function I(e){return!!e.startContainer&&!!e.endContainer&&!j(e.startContainer)&&!j(e.endContainer)&&F(e.startContainer,e.startOffset)&&F(e.endContainer,e.endOffset)}function q(e){M(e);if(!I(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function X(e,t){q(e);var r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,u=r===s;n.isCharacterDataNode(s)&&o>0&&o<s.length&&n.splitDataNode(s,o,t),n.isCharacterDataNode(r)&&i>0&&i<r.length&&(r=n.splitDataNode(r,i,t),u?(o-=i,s=r):s==r.parentNode&&o>=n.getNodeIndex(r)&&o++,i=0),e.setStartAndEnd(r,i,s,o)}function tt(){}function nt(e){e.START_TO_START=$,e.START_TO_END=J,e.END_TO_END=K,e.END_TO_START=Q,e.NODE_BEFORE=G,e.NODE_AFTER=Y,e.NODE_BEFORE_AND_AFTER=Z,e.NODE_INSIDE=et}function rt(e){nt(e),nt(e.prototype)}function it(e,t){return function(){q(this);var r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,o=new y(this,!0),u,a;r!==s&&(u=n.getClosestAncestorIn(r,s,!0),a=f(u),r=a.node,i=a.offset),p(o,H),o.reset();var l=e(o);return o.detach(),t(this,r,i,r,i),l}}function st(e,t,i){function s(e,t){return function(n){M(this),_(n,w),_(C(n),E);var r=(e?a:f)(n);(t?u:l)(this,r.node,r.offset)}}function u(e,r,i){var s=e.endContainer,o=e.endOffset;if(r!==e.startContainer||i!==e.startOffset){if(C(r)!=C(s)||n.comparePoints(r,i,s,o)==1)s=r,o=i;t(e,r,i,s,o)}}function l(e,r,i){var s=e.startContainer,o=e.startOffset;if(r!==e.endContainer||i!==e.endOffset){if(C(r)!=C(s)||n.comparePoints(r,i,s,o)==-1)s=r,o=i;t(e,s,o,r,i)}}e.prototype=new tt,r.extend(e.prototype,{setStart:function(e,t){M(this),O(e,!0),D(e,t),u(this,e,t)},setEnd:function(e,t){M(this),O(e,!0),D(e,t),l(this,e,t)},setStartAndEnd:function(){M(this);var e=arguments,n=e[0],r=e[1],i=n,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}t(this,n,r,i,s)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){q(this),e?t(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):t(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){M(this),O(e,!0),t(this,e,0,e,n.getNodeLength(e))},selectNode:function(e){M(this),O(e,!1),_(e,w);var n=a(e),r=f(e);t(this,n.node,n.offset,r.node,r.offset)},extractContents:it(v,t),deleteContents:it(d,t),canSurroundContents:function(){q(this),H(this.startContainer),H(this.endContainer);var e=new y(this,!0),t=e._first&&o(e._first,this)||e._last&&o(e._last,this);return e.detach(),!t},detach:function(){i(this)},splitBoundaries:function(){X(this)},splitBoundariesPreservingPositions:function(e){X(this,e)},normalizeBoundaries:function(){q(this);var e=this.startContainer,r=this.startOffset,i=this.endContainer,s=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,s=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},u=function(t){var o=t.previousSibling;if(o&&o.nodeType==t.nodeType){e=t;var u=t.length;r=o.length,t.insertData(0,o.data),o.parentNode.removeChild(o);if(e==i)s+=r,i=e;else if(i==t.parentNode){var a=n.getNodeIndex(t);s==a?(i=t,s=u):s>a&&s--}}},a=!0;if(n.isCharacterDataNode(i))i.length==s&&o(i);else{if(s>0){var f=i.childNodes[s-1];f&&n.isCharacterDataNode(f)&&o(f)}a=!this.collapsed}if(a){if(n.isCharacterDataNode(e))r==0&&u(e);else if(r<e.childNodes.length){var l=e.childNodes[r];l&&n.isCharacterDataNode(l)&&u(l)}}else e=i,r=s;t(this,e,r,i,s)},collapseToPoint:function(e,t){M(this),O(e,!0),D(e,t),this.setStartAndEnd(e,t)}}),rt(e)}function ot(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function ut(e,t,n,r,i){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,ot(e)}function at(e){M(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null}function ft(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,ot(this)}e.requireModules(["DomUtil"]);var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException;y.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,n.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,r;!n.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,r=e===this.ec?this.eo:e.length,t!=r&&e.deleteData(t,r-t))},isPartiallySelectedSubtree:function(){var e=this._current;return o(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new ft(u(this.range));var t=this._current,r=t,i=0,s=t,o=n.getNodeLength(t);n.isOrIsAncestorOf(t,this.sc)&&(r=this.sc,i=this.so),n.isOrIsAncestorOf(t,this.ec)&&(s=this.ec,o=this.eo),ut(e,r,i,s,o)}return new y(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},b.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},b.prototype.toString=function(){return this.message};var w=[1,3,4,5,7,8,10],E=[2,9,11],S=[5,6,10,12],x=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],C=n.getRootContainer,k=N([9,11]),L=N(S),A=N([6,10,12]),R=document.createElement("style"),U=!1;try{R.innerHTML="<b>x</b>",U=R.firstChild.nodeType==3}catch(z){}e.features.htmlParsingConforms=U;var W=U?function(e){var t=this.startContainer,r=n.getDocument(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:n.isCharacterDataNode(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(n.getDocument(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){M(this);var t=u(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},V=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],$=0,J=1,K=2,Q=3,G=0,Y=1,Z=2,et=3;tt.prototype={compareBoundaryPoints:function(e,t){q(this),P(this.startContainer,t.startContainer);var r,i,s,o,u=e==Q||e==$?"start":"end",a=e==J||e==$?"start":"end";return r=this[u+"Container"],i=this[u+"Offset"],s=t[a+"Container"],o=t[a+"Offset"],n.comparePoints(r,i,s,o)},insertNode:function(e){q(this),_(e,x),H(this.startContainer);if(n.isOrIsAncestorOf(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=l(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){q(this);var e,t;if(this.collapsed)return u(this).createDocumentFragment();if(this.startContainer===this.endContainer&&n.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=u(this).createDocumentFragment(),t.appendChild(e),t;var r=new y(this,!0);return e=h(r),r.detach(),e},canSurroundContents:function(){q(this),H(this.startContainer),H(this.endContainer);var e=new y(this,!0),t=e._first&&o(e._first,this)||e._last&&o(e._last,this);return e.detach(),!t},surroundContents:function(e){_(e,T);if(!this.canSurroundContents())throw new b("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);l(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){q(this);var e=new ft(u(this)),t=V.length,n;while(t--)n=V[t],e[n]=this[n];return e},toString:function(){q(this);var e=this.startContainer;if(e===this.endContainer&&n.isCharacterDataNode(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],r=new y(this,!0);return p(r,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),r.detach(),t.join("")},compareNode:function(e){q(this);var t=e.parentNode,r=n.getNodeIndex(e);if(!t)throw new s("NOT_FOUND_ERR");var i=this.comparePoint(t,r),o=this.comparePoint(t,r+1);return i<0?o>0?Z:G:o>0?Y:et},comparePoint:function(e,t){return q(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:n.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:W,toHtml:function(){q(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){q(this),B(e,"NOT_FOUND_ERR");if(n.getDocument(e)!==u(this))return!1;var r=e.parentNode,i=n.getNodeIndex(e);B(r,"NOT_FOUND_ERR");var s=n.comparePoints(r,i,this.endContainer,this.endOffset),o=n.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?s<=0&&o>=0:s<0&&o>0},isPointInRange:function(e,t){return q(this),B(e,"HIERARCHY_REQUEST_ERR"),P(e,this.startContainer),n.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&n.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return c(this,e,!1)},intersectsOrTouchesRange:function(e){return c(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=n.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),r=n.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return t==-1&&i.setStart(e.startContainer,e.startOffset),r==1&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return n.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),n.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new b("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==et},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,n.getNodeLength(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);var i=this.containsRange(t);return t.detach(),i}return this.containsNodeContents(e)},getNodes:function(e,t){return q(this),m(this,e,t)},getDocument:function(){return u(this)},collapseBefore:function(e){M(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){M(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return ft.rangesEqual(this,e)},isValid:function(){return I(this)},inspect:function(){return g(this)}},st(ft,ut,at),e.rangePrototype=tt.prototype,r.extend(ft,{rangeProperties:V,RangeIterator:y,copyComparisonConstants:rt,createPrototypeRange:st,inspect:g,getRangeDocument:u,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=ft,e.RangeException=b}),rangy.createModule("WrappedRange",function(e,t){function u(e,n){e=r.getContentDocument(e);if(!e)throw t.createError(n+"(): Parameter must be a Document or other DOM node, or a Window object");return e}function a(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=i==s?i:r.getCommonAncestor(i,s);return o==t?o:r.getCommonAncestor(t,o)}function f(e){return e.compareEndPoints("StartToEnd",e)==0}function l(e,t,n,i,o){var u=e.duplicate();u.collapse(n);var a=u.parentElement();r.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML)return new s(a.parentNode,r.getNodeIndex(a));var f=r.getDocument(a).createElement("span");f.parentNode&&f.parentNode.removeChild(f);var l,c=n?"StartToStart":"StartToEnd",h,p,d,v,m=o&&o.containerElement==a?o.nodeIndex:0,g=a.childNodes.length,y=g,b=y;for(;;){b==g?a.appendChild(f):a.insertBefore(f,a.childNodes[b]),u.moveToElementText(f),l=u.compareEndPoints(c,e);if(l==0||m==y)break;if(l==-1){if(y==m+1)break;m=b}else y=y==m+1?m:b;b=Math.floor((m+y)/2),a.removeChild(f)}v=f.nextSibling;if(l==-1&&v&&r.isCharacterDataNode(v)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var w;if(/[\r\n]/.test(v.data)){var E=u.duplicate(),S=E.text.replace(/\r\n/g,"\r").length;w=E.moveStart("character",S);while((l=E.compareEndPoints("StartToEnd",E))==-1)w++,E.moveStart("character",1)}else w=u.text.length;d=new s(v,w)}else h=(i||!n)&&f.previousSibling,p=(i||n)&&f.nextSibling,p&&r.isCharacterDataNode(p)?d=new s(p,0):h&&r.isCharacterDataNode(h)?d=new s(h,h.data.length):d=new s(a,r.getNodeIndex(f));return f.parentNode.removeChild(f),{boundaryPosition:d,nodeInfo:{nodeIndex:b,containerElement:a}}}function c(e,t){var n,i,s=e.offset,o=r.getDocument(e.node),u,a,f=o.body.createTextRange(),l=r.isCharacterDataNode(e.node);return l?(n=e.node,i=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,i=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?i.insertBefore(u,n):i.appendChild(u),f.moveToElementText(u),f.collapse(!t),i.removeChild(u),l&&f[t?"moveStart":"moveEnd"]("character",s),f}e.requireModules(["DomUtil","DomRange"]);var n,r=e.dom,i=e.util,s=r.DomPosition,o=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange))(function(){function u(e){var t=s.length,n;while(t--)n=s[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}function f(e){e.nativeRange.detach(),e.detached=!0;var t=s.length,n;while(t--)n=s[t],e[n]=null}var e,s=o.rangeProperties,l;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},o.createPrototypeRange(n,a,f),e=n.prototype,e.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},e.collapse=function(e){this.nativeRange.collapse(e),u(this)},e.cloneRange=function(){return new n(this.nativeRange.cloneRange())},e.refresh=function(){u(this)},e.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");r.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),e.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},e.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){e.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},e.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}e.setStartBefore=l("setStartBefore","setEndBefore"),e.setStartAfter=l("setStartAfter","setEndAfter"),e.setEndBefore=l("setEndBefore","setStartBefore"),e.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),h.startContainer==c&&h.endContainer==c&&h.startOffset==0&&h.endOffset==c.length?e.selectNodeContents=function(e){this.nativeRange.selectNodeContents(e),u(this)}:e.selectNodeContents=function(e){this.setStart(e,0),this.setEnd(e,o.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,4),d.setStart(c,2),h.compareBoundaryPoints(h.START_TO_END,d)==-1&&h.compareBoundaryPoints(h.END_TO_START,d)==1?e.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:e.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var m=v.firstChild;document.body.appendChild(v),h.setStart(m,1),h.setEnd(m,2),h.deleteContents(),m.data=="13"&&(e.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},e.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),document.body.removeChild(v),i.isHostMethod(h,"createContextualFragment")&&(e.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),r.getBody(document).removeChild(c),h.detach(),d.detach()})(),e.createNativeRange=function(e){return e=u(e,"createNativeRange"),e.createRange()};else if(e.features.implementsTextRange){n=function(e){this.textRange=e,this.refresh()},n.prototype=new o(document),n.prototype.refresh=function(){var e,t,n,r=a(this.textRange);f(this.textRange)?t=e=l(this.textRange,r,!0,!0).boundaryPosition:(n=l(this.textRange,r,!0,!1),e=n.boundaryPosition,t=l(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.copyComparisonConstants(n);var h=function(){return this}();typeof h.Range=="undefined"&&(h.Range=n),e.createNativeRange=function(e){return e=u(e,"createNativeRange"),e.body.createTextRange()}}e.features.implementsTextRange&&(n.rangeToTextRange=function(e){if(e.collapsed)return c(new s(e.startContainer,e.startOffset),!0);var t=c(new s(e.startContainer,e.startOffset),!0),n=c(new s(e.endContainer,e.endOffset),!1),i=r.getDocument(e.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i}),n.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createRange=function(t){return t=u(t,"createRange"),new n(e.createNativeRange(t))},e.createRangyRange=function(e){return e=u(e,"createRangyRange"),new o(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function h(e){return typeof e=="string"?e=="backward":!!e}function p(e,n){if(!e)return window;if(r.isWindow(e))return e;if(e instanceof q)return e.win;var i=r.getContentDocument(e);if(!i)throw t.createError(n+"(): "+"Parameter must be a Window object or DOM node");return r.getWindow(i)}function d(e){return p(e,"getWinSelection").getSelection()}function v(e){return p(e,"getDocSelection").document.selection}function A(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function O(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function M(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function _(t){var n;return t instanceof s?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof o?n=t.nativeRange:e.features.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(n=t),n}function D(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!r.isAncestorOf(e[0],e[t]))return!1;return!0}function P(e){var n=e.getNodes();if(!D(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function H(e){return!!e&&typeof e.text!="undefined"}function B(e,t){var n=new o(t);e._ranges=[n],A(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function j(t){t._ranges.length=0;if(t.docSelection.type=="None")M(t);else{var n=t.docSelection.createRange();if(H(n))B(t,n);else{t.rangeCount=n.length;var i,s=r.getDocument(n.item(0));for(var o=0;o<t.rangeCount;++o)i=e.createRange(s),i.selectNode(n.item(o)),t._ranges.push(i);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,A(t,t._ranges[t.rangeCount-1],!1)}}}function F(e,n){var i=e.docSelection.createRange(),s=P(n),o=r.getDocument(i.item(0)),u=r.getBody(o).createControlRange();for(var a=0,f=i.length;a<f;++a)u.add(i.item(a));try{u.add(s)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}u.select(),j(e)}function q(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function R(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.detached=!0}function z(e,t){var n=U.length,r,i;while(n--){r=U[n],i=r.selection;if(t=="deleteAll")R(i);else if(r.win==e)return t=="delete"?(U.splice(n,1),!0):i}return t=="deleteAll"&&(U.length=0),null}function X(e,n){var i=r.getDocument(n[0].startContainer),s=r.getBody(i).createControlRange();for(var o=0,u;o<rangeCount;++o){u=P(n[o]);try{s.add(u)}catch(a){throw t.createError("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}s.select(),j(e)}function Q(e,t){if(e.anchorNode&&r.getDocument(e.anchorNode)!==r.getDocument(t))throw new u("WRONG_DOCUMENT_ERR")}function G(e){var t=[],n=new a(e.anchorNode,e.anchorOffset),r=new a(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var o=0,u=e.rangeCount;o<u;++o)t[o]=s.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var n="boolean",r=e.dom,i=e.util,s=e.DomRange,o=e.WrappedRange,u=e.DOMException,a=r.DomPosition,f,l,c="Control",m=e.util.isHostMethod(window,"getSelection"),g=e.util.isHostObject(document,"selection");e.features.implementsWinGetSelection=m,e.features.implementsDocSelection=g;var y=g&&(!m||e.config.preferTextRange);y?(f=v,e.isSelectionValid=function(e){var t=p(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||r.getDocument(n.createRange().parentElement())==t}):m?(f=d,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=f;var b=f(),w=e.createNativeRange(document),E=r.getBody(document),S=i.areHostProperties(b,["anchorNode","focusNode","anchorOffset","focusOffset"]);e.features.selectionHasAnchorAndFocus=S;var x=i.isHostMethod(b,"extend");e.features.selectionHasExtend=x;var T=typeof b.rangeCount=="number";e.features.selectionHasRangeCount=T;var N=!1,C=!0;i.areHostMethods(b,["addRange","getRangeAt","removeAllRanges"])&&typeof b.rangeCount=="number"&&e.features.implementsDomRange&&function(){var e=window.getSelection();if(e){var t=r.getBody(document),n=t.appendChild(document.createElement("div"));n.contentEditable="false";var i=n.appendChild(document.createTextNode("")),s=document.createRange();s.setStart(i,1),s.collapse(!0),e.addRange(s),C=e.rangeCount==1,e.removeAllRanges();var o=s.cloneRange();s.setStart(i,0),o.setEnd(i,3),o.setStart(i,2),e.addRange(s),e.addRange(o),N=e.rangeCount==2,t.removeChild(n),e.removeAllRanges(),s.detach(),o.detach()}}(),e.features.selectionSupportsMultipleRanges=N,e.features.collapsedNonEditableSelectionsSupported=C;var k=!1,L;E&&i.isHostMethod(E,"createControlRange")&&(L=E.createControlRange(),i.areHostProperties(L,["item","add"])&&(k=!0)),e.features.implementsControlRange=k,S?l=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:l=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var I;i.isHostMethod(b,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:S&&(I=function(t){var n=r.getDocument(t.anchorNode),i=e.createRange(n);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i});var U=[];e.getSelection=function(e){if(e&&e instanceof q)return e.refresh(),e;e=p(e,"getSelection");var t=z(e),n=f(e),r=g?v(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new q(n,r,e),U.push({win:e,selection:t})),t},e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(r.getIframeWindow(n))};var W=q.prototype;if(!y&&S&&i.areHostMethods(b,["removeAllRanges","addRange"])){W.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),M(this)};var V=function(t,n){var r=s.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(_(i)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};T?W.addRange=function(t,n){if(k&&g&&this.docSelection.type==c)F(this,t);else if(h(n)&&x)V(this,t);else{var r;N?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(_(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=I(this.nativeSelection,this.rangeCount-1);i&&!s.rangesEqual(i,t)&&(t=new o(i))}this._ranges[this.rangeCount-1]=t,A(this,t,K(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:W.addRange=function(e,t){h(t)&&x?V(this,e):(this.nativeSelection.addRange(_(e)),this.refresh())},W.setRanges=function(e){if(k&&e.length>1)X(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(i.isHostMethod(b,"empty")&&i.isHostMethod(w,"select")&&k&&y))return t.fail("No means of selecting a Range or TextRange was found"),!1;W.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=r.getDocument(this.anchorNode);else if(this.docSelection.type==c){var t=this.docSelection.createRange();t.length&&(e=r.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}M(this)},W.addRange=function(e){this.docSelection.type==c?F(this,e):(o.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,A(this,e,!1))},W.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?X(this,e):t&&this.addRange(e[0])}}W.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new u("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var $;if(y)$=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=r.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==c?j(t):H(n)?B(t,n):M(t)};else if(i.isHostMethod(b,"getRangeAt")&&typeof b.rangeCount=="number")$=function(t){if(k&&g&&t.docSelection.type==c)j(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));A(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=l(t)}else M(t)}};else{if(!S||typeof b.isCollapsed!=n||typeof w.collapsed!=n||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;$=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=I(n,0),e._ranges=[t],e.rangeCount=1,O(e),e.isCollapsed=l(e)):M(e)}}W.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;$(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!s.rangesEqual(t[i],this._ranges[i]))return!0;return!1}};var J=function(t,n){var r=t.getAllRanges();t.removeAllRanges();for(var i=0,s=r.length;i<s;++i)e.DomRange.rangesEqual(n,r[i])||t.addRange(r[i]);t.rangeCount||M(t)};k?W.removeRange=function(e){if(this.docSelection.type==c){var t=this.docSelection.createRange(),n=P(e),i=r.getDocument(t.item(0)),s=r.getBody(i).createControlRange(),o,u=!1;for(var a=0,f=t.length;a<f;++a)o=t.item(a),o!==n||u?s.add(t.item(a)):u=!0;s.select(),j(this)}else J(this,e)}:W.removeRange=function(e){J(this,e)};var K;!y&&S&&e.features.implementsDomRange?(K=function(e){var t=!1;return e.anchorNode&&(t=r.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t},W.isBackward=function(){return K(this)}):K=W.isBackward=function(){return!1},W.isBackwards=W.isBackward,W.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},W.collapse=function(t,n){Q(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},W.collapseToStart=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},W.collapseToEnd=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},W.selectAllChildren=function(t){Q(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},W.deleteFromDocument=function(){if(k&&g&&this.docSelection.type==c){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}}},W.getAllRanges=function(){var e=[];for(var t=0,n=this._ranges.length;t<n;++t)e[t]=this.getRangeAt(t);return e},W.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},W.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},W.toHtml=function(){var e=[];if(this.rangeCount)for(var t=0,n=this._ranges.length;t<n;++t)e.push(this._ranges[t].toHtml());return e.join("")},W.getName=function(){return"WrappedSelection"},W.inspect=function(){return G(this)},W.detach=function(){z(this.win,"delete"),R(this)},q.detachAll=function(){z(null,"deleteAll")},q.inspect=G,q.isDirectionBackward=h,e.Selection=q,e.selectionPrototype=W,e.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return e.getSelection(t)}),t=null})}),rangy.createModule("SaveRestore",function(e,t){function i(e,t){return(t||document).getElementById(e)}function s(e,t){var i="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),s,o=n.getDocument(e.startContainer),u=e.cloneRange();return u.collapse(t),s=o.createElement("span"),s.id=i,s.style.lineHeight="0",s.style.display="none",s.className="rangySelectionBoundary",s.appendChild(o.createTextNode(r)),u.insertNode(s),u.detach(),s}function o(e,n,r,s){var o=i(r,e);o?(n[s?"setStartBefore":"setEndBefore"](o),o.parentNode.removeChild(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function u(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function a(t,n){var r,i,o=e.DomRange.getRangeDocument(t),u=t.toString();return t.collapsed?(i=s(t,!1),{document:o,markerId:i.id,collapsed:!0}):(i=s(t,!1),r=s(t,!0),{document:o,startMarkerId:r.id,endMarkerId:i.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+u+"', new text: '"+t.toString()+"'"}})}function f(n,r){var s=n.document;typeof r=="undefined"&&(r=!0);var u=e.createRange(s);if(n.collapsed){var a=i(n.markerId,s);if(a){a.style.display="inline";var f=a.previousSibling;f&&f.nodeType==3?(a.parentNode.removeChild(a),u.collapseToPoint(f,f.length)):(u.collapseBefore(a),a.parentNode.removeChild(a))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(s,u,n.startMarkerId,!0),o(s,u,n.endMarkerId,!1);return r&&u.normalizeBoundaries(),u}function l(t,n){var r=[],s,o;t=t.slice(0),t.sort(u);for(var f=0,l=t.length;f<l;++f)r[f]=a(t[f],n);for(f=l-1;f>=0;--f)s=t[f],o=e.DomRange.getRangeDocument(s),s.collapsed?s.collapseAfter(i(r[f].markerId,o)):(s.setEndBefore(i(r[f].endMarkerId,o)),s.setStartAfter(i(r[f].startMarkerId,o)));return r}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),s=i.length==1&&r.isBackward(),o=l(i,s);return r.setRanges(i),{win:n,rangeInfos:o,restored:!1}}function h(e){var t=[],n=e.length;for(var r=n-1;r>=0;r--)t[r]=f(e[r],!0);return t}function p(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),s=h(r),o=r.length;o==1&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0}}function d(e,t){var n=i(t,e);n&&n.parentNode.removeChild(n)}function v(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n)i=t[n],i.collapsed?d(e.doc,i.markerId):(d(e.doc,i.startMarkerId),d(e.doc,i.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var n=e.dom,r="";e.util.extend(e,{saveRange:a,restoreRange:f,saveRanges:l,restoreRanges:h,saveSelection:c,restoreSelection:p,removeMarkerElement:d,removeMarkers:v})}),LinkedList.prototype={length:0,first:null,last:null},LinkedList.prototype.append=function(e){typeof this.first=="undefined"||this.first===null?this.first=e:(e.next=null,this.last.next=e),e.prev=this.last,this.last=e,this.length++},LinkedList.prototype.insertAfter=function(e,t){t.prev=e,e?(t.next=e.next,typeof e.next!="undefined"&&e.next!==null&&(e.next.prev=t),e.next=t,e===this.last&&(this.last=t)):(t.next=this.first,this.first.prev=t,this.first=t),this.length++},LinkedList.prototype.remove=function(e){this.length>1?(typeof e.prev!="undefined"&&e.prev!==null&&(e.prev.next=e.next),typeof e.next!="undefined"&&e.next!==null&&(e.next.prev=e.prev),e==this.first&&(this.first=e.next),e==this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.prev=null,e.next=null,this.length--},LinkedList.prototype.toArray=function(){var e=[],t=this.first;while(t)e.push(t),t=t.next;return e},LinkedList.Node=function(e){this.prev=null,this.next=null,this.data=e},function(){var e;e={DEFAULT_LEAF_FORMATS:{background:"white",color:"black",family:"san-serif",size:"normal"},FONT_BACKGROUNDS:["black","blue","green","orange","purple","red","white","yellow"],FONT_COLORS:["black","blue","green","orange","red","white","yellow"],FONT_FAMILIES:["monospace","serif"],FONT_SIZES:["huge","large","small"],INDENT_FORMATS:{bullet:[0,1,2,3,4,5,6,7,8],indent:[0,1,2,3,4,5,6,7,8],list:[0,1,2,3,4,5,6,7,8]},LINE_RULES:{A:{},B:{},BR:{},BIG:{rename:"span"},CENTER:{rename:"span"},DEL:{rename:"s"},EM:{rename:"i"},H1:{rename:"div"},H2:{rename:"div"},H3:{rename:"div"},H4:{rename:"div"},H5:{rename:"div"},H6:{rename:"div"},I:{},INS:{rename:"span"},LI:{},OL:{},S:{},SMALL:{rename:"span"},SPAN:{},STRIKE:{rename:"s"},STRONG:{rename:"b"},U:{},UL:{}},LIST_TAGS:["OL","UL"],MAX_INDENT:9,MIN_INDENT:1,NOBREAK_SPACE:"",SPECIAL_CLASSES:{EXTERNAL:"ext"}},e.SPAN_FORMATS={background:e.FONT_BACKGROUNDS,color:e.FONT_COLORS,family:e.FONT_FAMILIES,size:e.FONT_SIZES},e.TAG_FORMATS={bold:[!0,!1],italic:[!0,!1],link:[!0,!1],strike:[!0,!1],underline:[!0,!1]},e.LEAF_FORMATS=_.extend({},e.SPAN_FORMATS,e.TAG_FORMATS),window.Scribe||(window.Scribe={}),window.Scribe.Constants=e}.call(this),function(){var e;e={getEditor:function(e){return e||(e=Scribe.Editor.editors[0]),_.isNumber(e)?Scribe.Editor.editors[e]:e},getHtml:function(e){var t;return t=this.getDocument(e),t.root},getDocument:function(e){return e=this.getEditor(e),e.doc},checkDocumentConsistency:function(e,t){var n,r,i;return t==null&&(t=!1),i=_.map(_.clone(e.root.childNodes),function(e){var t;return t=e.querySelectorAll("*"),_.filter(t,function(e){return e.nodeType===e.ELEMENT_NODE&&!e.classList.contains(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)&&(e.nodeName==="BR"||e.firstChild==null||e.firstChild.nodeType===e.TEXT_NODE)})}),r=e.lines.toArray(),n=function(){var t,n,s=this;return r.length!==_.values(e.lineMap).length?(console.error("doc.lines and doc.lineMap differ in length",r.length,_.values(e.lineMap).length),!1):_.any(r,function(t){return t==null||e.lineMap[t.id]!==t?(t!=null?console.error(t,"does not match",e.lineMap[t.id]):console.error("null line"),!0):!1})?!1:(t=n=null,_.any(r,function(e){return _.any(e.leaves.toArray(),function(r){return r.node.parentNode===null?(t=r,n=e,!0):!1})})?(console.error("Missing from DOM",n,t),!1):_.any(r,function(e){var t;return t=_.reduce(e.leaves.toArray(),function(e,t){return t.length+e},0),e.trailingNewline&&(t+=1),t!==e.length?(console.error("incorrect line length",t,e.length),!0):!1})?!1:_.any(r,function(e){return e.node.tagName!=="OL"&&e.node.tagName!=="UL"||e.node.firstChild.tagName==="LI"?!1:(console.error("inconsistent bullet/list",e),!0)})?!1:r.length!==i.length?(console.error("doc.lines and nodesByLine differ in length",r,i),!1):_.any(r,function(e,t){var n,r,s,o;return n=_.reduce(e.node.childNodes,function(e,t){return Scribe.Utils.getNodeLength(t)+e},0),e.trailingNewline&&(n+=1),e.length!==n?(console.error(e,e.length,n,"differ in length"),!0):(s=e.leaves.toArray(),r=_.map(s,function(e){return e.node}),_.isEqual(r,i[t])?(s=_.map(s,function(e){return _.pick(e,"formats","length","line","node","text")}),e.rebuild(),o=_.map(e.leaves.toArray(),function(e){return _.pick(e,"formats","length","line","node","text")}),_.isEqual(s,o)?!1:(console.error(s,"leaves differ from",o),!0)):(console.error(e,r,"nodes differ from",i[t]),!0))})?!1:!0)},n()?!0:(t&&(console.error(e.root),console.error(i),console.error(r),console.error(e.lineMap)),!1)},Test:{getRandomLength:function(){var e;return e=Math.random(),e<.1?1:e<.6?_.random(0,2):e<.8?_.random(3,4):e<.9?_.random(5,9):_.random(10,50)},getRandomOperation:function(e,t,n){var r,i,s,o,u,a,f;return i=_.keys(n),a=Math.random(),u=e.getLength()-1,a<.2?s=0:a<.4?s=u:s=_.random(0,u),o=Scribe.Debug.Test.getRandomLength()+1,a=Math.random(),a<.5?{op:"insertAt",args:[s,Scribe.Debug.Test.getRandomString(t,o)]}:a<.75?s+o>u?null:{op:"deleteAt",args:[s,o-1]}:(r=i[_.random(0,i.length-1)],f=n[r][_.random(0,n[r].length-1)],r==="link"&&f===!0&&(f="http://www.google.com"),{op:"formatAt",args:[s,o,r,f]})},getRandomString:function(e,t){var n,r,i;return _.map(function(){i=[];for(var e=0,n=t-1;0<=n?e<=n:e>=n;0<=n?e++:e--)i.push(e);return i}.apply(this),function(){return e[_.random(0,e.length-1)]}).join("")}}},window.Scribe||(window.Scribe={}),window.Scribe.Debug=e}.call(this),function(){var e;e=function(){function e(e){this.root=e,this.buildLines()}return e.INDENT_PREFIX="indent-",e.prototype.appendLine=function(e){return this.insertLineBefore(e,null)},e.prototype.buildLines=function(){return this.reset(),Scribe.Normalizer.normalizeDoc(this.root),this.rebuild()},e.prototype.cleanNode=function(e){var t;if(e.classList.contains(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL))return;return t=this.findLine(e),t!=null&&this.updateLine(t)?(e.classList.remove(Scribe.Line.DIRTY_CLASS),!0):!1},e.prototype.findLeaf=function(e){var t,n;n=e.parentNode;while(n!=null&&!Scribe.Line.isLineNode(n))n=n.parentNode;return n==null?null:(t=this.findLine(n),t.findLeaf(e))},e.prototype.findLine=function(e){return e=this.findLineNode(e),e!=null?this.lineMap[e.id]:null},e.prototype.findLineAtOffset=function(e){var t,n=this;return t=this.lines.first,_.all(this.lines.toArray(),function(r,i){return t=r,e<r.length?!1:(i<n.lines.length-1&&(e-=r.length),!0)}),[t,e]},e.prototype.findLineNode=function(e){while(e!=null&&!Scribe.Line.isLineNode(e))e=e.parentNode;return e},e.prototype.insertLineBefore=function(e,t){var n;return n=new Scribe.Line(this,e),t!==null?this.lines.insertAfter(t.prev,n):this.lines.append(n),this.lineMap[n.id]=n,n},e.prototype.mergeLines=function(e,t){if(e==null||t==null)return;return _.each(_.clone(t.node.childNodes),function(t){return e.node.appendChild(t)}),Scribe.Utils.removeNode(t.node),this.removeLine(t),e.trailingNewline=t.trailingNewline,e.rebuild()},e.prototype.rebuild=function(){var e=this;return this.reset(),_.each(Scribe.DOM.filterUneditable(this.root.childNodes),function(t){return e.appendLine(t)})},e.prototype.rebuildDirty=function(){var e,t=this;return this.root.firstChild!=null&&this.root.firstChild.classList.add(Scribe.Line.DIRTY_CLASS),this.root.lastChild!=null&&this.root.lastChild.classList.add(Scribe.Line.DIRTY_CLASS),e=_.clone(this.root.getElementsByClassName(Scribe.Line.DIRTY_CLASS)),_.each(e,function(n,r){var i,s,o;t.cleanNode(n),s=n.previousSibling,i=n.nextSibling;while(s!=null&&s!==e[r-1])t.cleanNode(s),s=s.previousSibling;o=[];while(i!=null&&i!==e[r+1])t.cleanNode(i),o.push(i=i.nextSibling);return o})},e.prototype.removeLine=function(e){return delete this.lineMap[e.id],this.lines.remove(e)},e.prototype.reset=function(){return this.lines=new LinkedList,this.lineMap={}},e.prototype.splitLine=function(e,t){var n,r,i;return i=Scribe.DOM.splitNode(e.node,t,!0),n=i[0],r=i[1],e.node=n,this.updateLine(e),this.insertLineBefore(r,e.next)},e.prototype.toDelta=function(){var e,t,n;return t=this.lines.toArray(),n=_.flatten(_.map(t,function(e,t){return n=Tandem.Delta.copy(e.delta).ops,n}),!0),e=new Tandem.Delta(0,n),e},e.prototype.updateLine=function(e){return e.rebuild()},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Document=e}.call(this),function(){var e,t=[].slice;e={canEdit:function(e){return e.nodeType===e.TEXT_NODE||!e.classList.contains(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)},filterUneditable:function(e){var t=this;return _.filter(e,function(e){return t.canEdit(e)})},isTextNodeParent:function(e){var t;return t=Scribe.DOM.filterUneditable(e.childNodes),t.length===1&&t[0].nodeType===e.TEXT_NODE},mergeNodes:function(e,t){return e==null?t:t==null?e:(this.moveChildren(e,t),t.parentNode.removeChild(t),(e.tagName==="OL"||e.tagName==="UL")&&e.childNodes.length===2&&Scribe.DOM.mergeNodes(e.firstChild,e.lastChild),e)},moveChildren:function(e,t){return _.each(_.clone(t.childNodes),function(t){return e.appendChild(t)})},splitAfter:function(e,t){var n,r;if(e===t||e.parentNode===t)return!1;r=e.parentNode,n=r.cloneNode(!1),r.parentNode.insertBefore(n,r.nextSibling);while(e.nextSibling!=null)n.appendChild(e.nextSibling);return Scribe.DOM.splitAfter(r,t)},splitNode:function(e,t,n){var r,i,s,o,u,a,f,l,c,h;n==null&&(n=!1);if(t>Scribe.Utils.getNodeLength(e))throw new Error("Splitting at offset greater than node length");e.nodeType===e.TEXT_NODE&&(e=this.wrap(e.ownerDocument.createElement("span"),e));if(!n){if(t===0)return[e.previousSibling,e,!1];if(t===Scribe.Utils.getNodeLength(e))return[e,e.nextSibling,!1]}a=e,l=e.cloneNode(!1),e.parentNode.insertBefore(l,a.nextSibling);if(Scribe.DOM.isTextNodeParent(e))return i=e.textContent.substring(0,t),r=e.textContent.substring(t),a.textContent=i,l.textContent=r,[a,l,!0];c=Scribe.Utils.getChildAtOffset(e,t),s=c[0],t=c[1],h=Scribe.DOM.splitNode(s,t),o=h[0],u=h[1];while(u!==null)f=u.nextSibling,l.appendChild(u),u=f;return[a,l,!0]},switchTag:function(e,t){var n;if(e.tagName===t)return;return n=e.ownerDocument.createElement(t),this.moveChildren(n,e),e.parentNode.replaceChild(n,e),e.className&&(n.className=e.className),e.id&&(n.id=e.id),n},traversePostorder:function(e,t,n){var r,i;n==null&&(n=t);if(e==null)return;r=e.firstChild,i=[];while(r!=null)Scribe.DOM.traversePostorder.call(n,r,t),r=t.call(n,r),r!=null?i.push(r=r.nextSibling):i.push(void 0);return i},traversePreorder:function(){var e,n,r,i,s,o,u,a,f;a=arguments[0],u=arguments[1],s=arguments[2],n=arguments[3],e=5<=arguments.length?t.call(arguments,4):[],n==null&&(n=s);if(a==null)return;r=a.firstChild,f=[];while(r!=null)Scribe.DOM.canEdit(r)?(o=u+Scribe.Utils.getNodeLength(r),i=r.innerHTML,r=s.apply(n,[r,u].concat(e)),Scribe.DOM.traversePreorder.apply(null,[r,u,s,n].concat(e)),r!=null&&r.innerHTML===i?(r=r.nextSibling,f.push(u=o)):f.push(void 0)):f.push(r=r.nextSibling);return f},traverseSiblings:function(e,t,n){var r,i;i=[];while(e!=null){r=e.nextSibling,n(e);if(e===t)break;i.push(e=r)}return i},unwrap:function(e){var t;return t=e.firstChild,_.each(_.clone(e.childNodes),function(t){return e.parentNode.insertBefore(t,e)}),e.parentNode.removeChild(e),t},wrap:function(e,t){return t.parentNode.insertBefore(e,t),e.appendChild(t),e}},window.Scribe||(window.Scribe={}),window.Scribe.DOM=e}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t)c.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},p=[].slice;n=function(e){var t=this;return r.call(this,function(){return t.selection.preserve(function(){return f.call(t,function(){return a.call(t,function(){return e.call(t)})})})})},r=function(e){var t;return t=this.ignoreDomChanges,this.ignoreDomChanges=!0,e(),this.ignoreDomChanges=t},o=function(){var e,t,n,r=this;return t=function(){},e=function(){t=_.once(e);if(r.ignoreDomChanges)return;return l.call(r)},n=function(){var e;if(r.ignoreDomChanges)return;return e=t,_.defer(function(){return e.call(null)})},t=_.once(e),this.root.addEventListener("DOMSubtreeModified",n)},t=function(e,t){var n,r,i,s,o,u;if(t<=0)return;u=this.doc.findLineAtOffset(e),i=u[0],o=u[1],n=i;while(n!=null&&t>0)r=Math.min(t,n.length-o),s=n.next,n.length===r?(Scribe.Utils.removeNode(n.node),this.doc.removeLine(n)):n.deleteText(o,r),t-=r,n=s,o=0;if(i!=null&&!i.trailingNewline)return this.doc.mergeLines(i,i.next)},i=function(){var e;if((e=this.doc.lines.last)!=null?!e.trailingNewline:!void 0)return this.insertAt(this.getLength(),"\n")},s=function(e,t,n,r){var i,s,o,u;o=this.doc.findLineAtOffset(e),i=o[0],s=o[1],u=[];while(i!=null&&t>0)Scribe.Line.FORMATS[n]!=null?t>i.length-s&&i.format(n,r):Scribe.Constants.LEAF_FORMATS[n]!=null?i.length-s>=t?i.formatText(s,t,n,r):i.formatText(s,i.length-s,n,r):console.warn("Unsupported format",n,r),t-=i.length-s,s=0,u.push(i=i.next);return u},u=function(e,t,n){var r,i,s,o,u,a=this;return n==null&&(n={}),t=t.replace(/\r\n/g,"\n"),t=t.replace(/\r/g,"\n"),s=t.split("\n"),e===this.getLength()?(s[s.length-1]===""&&s.pop(),i=this.doc.splitLine(this.doc.lines.last,this.doc.lines.last.length),o=0):(u=this.doc.findLineAtOffset(e),i=u[0],o=u[1]),_.each(s,function(e,t){return i.insertText(o,e,n),t<s.length-1&&(i=a.doc.splitLine(i,o+e.length)),o=0})},a=function(e){return e.call(this),this.doc.rebuildDirty()},f=function(e){var t,n,r,i;return i=this.doc.toDelta(),e(),r=this.doc.toDelta(),n=r.decompose(i),t=i.compose(n),console.assert(t.isEqual(r),i,r,n,t),n.isIdentity()||this.emit(Scribe.Editor.events.TEXT_CHANGE,n),n},l=function(){var e=this;return r.call(this,function(){return e.selection.preserve(function(){return f.call(e,function(){var t,n,r,i;Scribe.Normalizer.breakBlocks(e.root),n=e.doc.lines.toArray(),t=e.root.firstChild,_.each(n,function(n,r){var i;while(n.node!==t){if(n.node.parentNode!==e.root){e.doc.removeLine(n);return}i=e.doc.insertLineBefore(t,n),t=t.nextSibling}return e.doc.updateLine(n),t=t.nextSibling}),i=[];while(t!==null)r=e.doc.appendLine(t),i.push(t=t.nextSibling);return i})})})},e=function(e){function a(e,t){this.iframeContainer=e,this.options=_.extend(Scribe.Editor.DEFAULTS,t),this.id=_.uniqueId(Scribe.Editor.ID_PREFIX),_.isString(this.iframeContainer)&&(this.iframeContainer=document.getElementById(this.iframeContainer)),this.reset(!0),this.options.enabled&&this.enable()}return h(a,e),a.editors=[],a.CONTAINER_ID="scribe-container",a.ID_PREFIX="editor-",a.CURSOR_PREFIX="cursor-",a.DEFAULTS={cursor:0,enabled:!0,styles:{}},a.events={TEXT_CHANGE:"text-change",SELECTION_CHANGE:"selection-change"},a.prototype.disable=function(){var e=this;return r.call(this,function(){return e.root.setAttribute("contenteditable",!1)})},a.prototype.enable=function(){var e=this;if(!this.root.getAttribute("contenteditable"))return r.call(this,function(){return e.root.setAttribute("contenteditable",!0)})},a.prototype.reset=function(e){var t;return e==null&&(e=!1),this.ignoreDomChanges=!0,t=_.clone(this.options),t.keepHTML=e,this.renderer=new Scribe.Renderer(this.iframeContainer,t),this.contentWindow=this.renderer.iframe.contentWindow,this.root=this.contentWindow.document.getElementById(Scribe.Editor.CONTAINER_ID),this.doc=new Scribe.Document(this.root),this.selection=new Scribe.Selection(this),this.keyboard=new Scribe.Keyboard(this),this.undoManager=new Scribe.UndoManager(this),this.pasteManager=new Scribe.PasteManager(this),o.call(this),this.ignoreDomChanges=!1,Scribe.Editor.editors.push(this)},a.prototype.applyDelta=function(e,n){var o=this;n==null&&(n=!0);if(e.startLength===0&&this.getLength()===1)return this.setDelta(e);if(e.isIdentity())return;return r.call(this,function(){return o.selection.preserve(function(){var r;return console.assert(e.startLength===o.getLength(),"Trying to apply delta to incorrect doc length",e,o.doc,o.root),r=o.doc.toDelta(),e.apply(u,t,s,o),n||o.emit(Scribe.Editor.events.TEXT_CHANGE,e),console.assert(e.endLength===o.getLength(),"Applying delta resulted in incorrect end length",e,o.getLength()),i.call(o)})})},a.prototype.deleteAt=function(){var e,r=this;return e=1<=arguments.length?p.call(arguments,0):[],n.call(this,function(){return t.apply(r,e),i.call(r)})},a.prototype.formatAt=function(){var e,t=this;return e=1<=arguments.length?p.call(arguments,0):[],n.call(this,function(){return s.apply(t,e)})},a.prototype.getDelta=function(){return this.doc.toDelta()},a.prototype.getLength=function(){return this.doc.toDelta().endLength},a.prototype.getSelection=function(){return this.selection.getRange()},a.prototype.insertAt=function(){var e,t=this;return e=1<=arguments.length?p.call(arguments,0):[],n.call(this,function(){return u.apply(t,e),i.call(t)})},a.prototype.setDelta=function(e){var t;return t=e.startLength,e.startLength=this.getLength(),this.applyDelta(e),e.startLength=t},a.prototype.setSelection=function(e){return this.selection.setRange(e)},a}(EventEmitter2),window.Scribe||(window.Scribe={}),window.Scribe.Editor=e}.call(this),function(){var e;e=function(){function e(e){this.editor=e,this.hotkeys={},this.initListeners(),this.initHotkeys()}return e.KEYS={BACKSPACE:8,TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},e.HOTKEYS={BOLD:{key:"B",meta:!0},ITALIC:{key:"I",meta:!0},UNDERLINE:{key:"U",meta:!0},UNDO:{key:"Z",meta:!0,shift:!1},REDO:{key:"Z",meta:!0,shift:!0}},e.PRINTABLE,e.prototype.initListeners=function(){var e=this;return this.editor.root.addEventListener("keydown",function(t){var n;return t||(t=window.event),e.hotkeys[t.which]!=null&&(n=!1,_.each(e.hotkeys[t.which],function(r){var i;if(r.meta!=null&&t.metaKey!==r.meta)return;if(r.shift!=null&&t.shiftKey!==r.shift)return;e.editor.selection.update(!0),i=e.editor.getSelection();if(i==null)return;return n=!0,r.callback.call(null,i)})),n&&t.preventDefault(),!n})},e.prototype.initHotkeys=function(){var e=this;return this.addHotkey(Scribe.Keyboard.KEYS.TAB,function(){return e.editor.selection.deleteRange(),e.insertText("	")}),this.addHotkey(Scribe.Keyboard.KEYS.ENTER,function(){return e.editor.selection.deleteRange(),e.insertText("\n")}),this.addHotkey(Scribe.Keyboard.HOTKEYS.BOLD,function(t){return e.toggleFormat(t,"bold")}),this.addHotkey(Scribe.Keyboard.HOTKEYS.ITALIC,function(t){return e.toggleFormat(t,"italic")}),this.addHotkey(Scribe.Keyboard.HOTKEYS.UNDERLINE,function(t){return e.toggleFormat(t,"underline")})},e.prototype.addHotkey=function(e,t){return e=_.isObject(e)?_.clone(e):{key:e},_.isString(e.key)&&(e.key=e.key.toUpperCase().charCodeAt(0)),e.callback=t,this.hotkeys[e.key]==null&&(this.hotkeys[e.key]=[]),this.hotkeys[e.key].push(e)},e.prototype.indent=function(e,t){var n,r,i=this;return r=e.getLines(),n=function(e,n){var r,s;return t?(r=_.isNumber(e.formats[n])?e.formats[n]:e.formats[n]?1:0,r+=t,r=Math.min(Math.max(r,Scribe.Constants.MIN_INDENT),Scribe.Constants.MAX_INDENT)):r=!1,s=Scribe.Position.getIndex(e.node,0),i.editor.formatAt(s,0,n,r)},_.each(r,function(e){return e.formats.bullet!=null?n(e,"bullet"):e.formats.list!=null?n(e,"list"):n(e,"indent"),i.editor.doc.rebuildDirty()})},e.prototype.onIndentLine=function(e){var t;return e==null?!1:(t=e.getFormats(),t.bullet!=null||t.indent!=null||t.list!=null)},e.prototype.insertText=function(e){var t,n;return n=this.editor.getSelection(),this.editor.insertAt(n.start.index,e),t=new Scribe.Range(this.editor,n.start.index+e.length,n.start.index+e.length),this.editor.setSelection(t)},e.prototype.toggleFormat=function(e,t){var n;return n=e.getFormats(),this.editor.selection.format(t,!n[t])},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Keyboard=e}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=function(e){function t(e,t,n){this.line=e,this.node=t,this.formats=_.clone(n),this.id=_.uniqueId(Scribe.Leaf.ID_PREFIX),this.node.tagName==="BR"&&(this.node.textContent=""),this.text=this.node.textContent,this.length=this.text.length}return r(t,e),t.ID_PREFIX="leaf-",t.isLeafNode=function(e){var t;return(e!=null?e.nodeType:void 0)!==e.ELEMENT_NODE?!1:Scribe.DOM.canEdit(e)?e.tagName==="BR"?!0:(t=Scribe.DOM.filterUneditable(e.childNodes),t.length===1&&t[0].nodeType===e.TEXT_NODE?!0:!1):!1},t.isLeafParent=function(e){var t;return(e!=null?e.nodeType:void 0)!==e.ELEMENT_NODE?!1:Scribe.DOM.canEdit(e)?(t=Scribe.DOM.filterUneditable(e.childNodes),t.length===0?!1:t.length>1||t[0].nodeType!==e.TEXT_NODE):!1},t.prototype.getFormats=function(e){var t;return e==null&&(e=!1),t=e?{}:_.clone(Scribe.Constants.DEFAULT_LEAF_FORMATS),_.extend(t,this.formats,this.line.formats)},t.prototype.getLineOffset=function(){return Scribe.Position.getIndex(this.node,0,this.line.node)},t.prototype.insertText=function(e,t){var n,r;return this.text=this.text.substring(0,e)+t+this.text.substring(e),r=Scribe.Position.findDeepestNode(this.line.doc.editor,this.node,e),n=r[0],e=r[1],n.textContent=n.textContent.substring(0,e)+t+n.textContent.substring(e),this.length=this.text.length},t}(LinkedList.Node),t=function(){function e(e,t){this.start=e,this.end=t,this.cur=this.start}return e.prototype.next=function(){var e,t;t=this.cur;if(this.cur===this.end||this.cur===null)this.cur=null;else if(this.cur.next!=null)this.cur=this.cur.next;else{e=this.cur.line.next;while(e!=null&&e.leaves.length===0)e=e.next;this.cur=e!=null?e.leaves.first:null}return t},e.prototype.toArray=function(){var e,t,n;e=[],t=new Scribe.LeafIterator(this.start,this.end);while(n=t.next())e.push(n);return e},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Leaf=e,window.Scribe.LeafIterator=t}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(e,n){this.doc=e,this.node=n,this.id=_.uniqueId(Scribe.Line.ID_PREFIX),this.node.id=this.id,this.node.classList.add(Scribe.Line.CLASS_NAME),this.trailingNewline=!0,this.rebuild(),t.__super__.constructor.call(this,this.node)}return n(t,e),t.CLASS_NAME="line",t.DIRTY_CLASS="dirty",t.ID_PREFIX="line-",t.BLOCK_TAGS=["ADDRESS","BLOCKQUOTE","DD","DIV","DL","H1","H2","H3","H4","H5","H6","LI","OL","P","PRE","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"],t.BREAK_TAGS=["BR","HR"],t.FORMATS={align:["center","justify","left","right"]},t.isLineNode=function(e){return e!=null&&e.classList!=null&&e.classList.contains(Scribe.Line.CLASS_NAME)},t.prototype.buildLeaves=function(e,t){var n=this;return _.each(Scribe.DOM.filterUneditable(e.childNodes),function(e){var r,i,s,o;s=_.clone(t),o=Scribe.Utils.getFormatForContainer(e),r=o[0],i=o[1],r!=null&&(s[r]=i),Scribe.Leaf.isLeafNode(e)&&n.leaves.append(new Scribe.Leaf(n,e,s));if(Scribe.Leaf.isLeafParent(e))return n.buildLeaves(e,s)})},t.prototype.applyToContents=function(e,t,n){var r,i,s,o,u,a;if(t<=0)return;return u=this.splitContents(e),s=u[0],o=u[1],a=this.splitContents(e+t),r=a[0],i=a[1],Scribe.DOM.traverseSiblings(o,r,n)},t.prototype.deleteText=function(e,t){return this.applyToContents(e,t,function(e){return Scribe.Utils.removeNode(e)}),this.length===e+t&&(this.trailingNewline=!1),this.rebuild()},t.prototype.findLeaf=function(e){var t;t=this.leaves.first;while(t!=null){if(t.node===e)return t;t=t.next}return null},t.prototype.findLeafAtOffset=function(e){var t;return t=this.leaves.first,_.all(this.leaves.toArray(),function(n){return t=n,e>n.length&&n.next!=null?(e-=n.length,!0):!1}),[t,e]},t.prototype.format=function(e,t){return console.warn("Unimplemented")},t.prototype.formatText=function(e,t,n,r){var i,s,o=this;if(t<=0)return;return r&&Scribe.Utils.getFormatDefault(n)!==r?(s=null,i=Scribe.Utils.createContainerForFormat(this.doc.root.ownerDocument,n,r),this.applyToContents(e,t,function(e){return s=e.nextSibling,i.appendChild(e),Scribe.Utils.removeFormatFromSubtree(e,n)}),this.node.insertBefore(i,s)):this.applyToContents(e,t,function(e){return Scribe.Utils.removeFormatFromSubtree(e,n)}),this.rebuild()},t.prototype.insertText=function(e,t,n){var r,i,s,o,u,a,f,l,c=this;return n==null&&(n={}),f=this.findLeafAtOffset(e),r=f[0],i=f[1],_.isEqual(r.formatting,n)?(r.insertText(i,t),this.length+=t.length,this.outerHTML=this.node.outerHTML,this.delta=this.toDelta()):(l=this.splitContents(e),u=l[0],s=l[1],a=this.node.ownerDocument.createElement("span"),a.textContent=t,o=(u!=null?u.parentNode:void 0)||(s!=null?s.parentNode:void 0),o.insertBefore(a,s),_.each(n,function(n,r){return c.formatText(e,t.length,r,n)}),this.rebuild())},t.prototype.rebuild=function(){if(this.node.parentNode===this.doc.root){if(this.outerHTML!=null&&this.outerHTML===this.node.outerHTML&&!this.node.classList.contains(Scribe.Line.DIRTY_CLASS))return!1;while(this.leaves!=null&&this.leaves.length>0)this.leaves.remove(this.leaves.first);this.leaves=new LinkedList,Scribe.Normalizer.normalizeLine(this.node),Scribe.Normalizer.optimizeLine(this.node),this.buildLeaves(this.node,{}),this.resetContent()}else this.doc.removeLine(this);return!0},t.prototype.resetContent=function(){var e,t,n;return this.length=_.reduce(this.leaves.toArray(),function(e,t){return t.length+e},0),this.trailingNewline&&(this.length+=1),this.outerHTML=this.node.outerHTML,this.formats={},n=Scribe.Utils.getFormatForContainer(this.node),e=n[0],t=n[1],e!=null&&(this.formats[e]=t),this.setDirty(!1),this.delta=this.toDelta()},t.prototype.setDirty=function(e){return e==null&&(e=!0),e?this.node.classList.add(Scribe.Line.DIRTY_CLASS):this.node.classList.remove(Scribe.Line.DIRTY_CLASS)},t.prototype.splitContents=function(e){var t,n,r;this.setDirty(),n=Scribe.Utils.getChildAtOffset(this.node,e),t=n[0],e=n[1];if(this.node.tagName==="OL"||this.node.tagName==="UL")r=Scribe.Utils.getChildAtOffset(t,e),t=r[0],e=r[1];return Scribe.DOM.splitNode(t,e)},t.prototype.toDelta=function(){var e,t;return t=_.map(this.leaves.toArray(),function(e){return new Tandem.InsertOp(e.text,e.getFormats(!0))}),this.trailingNewline&&t.push(new Tandem.InsertOp("\n",this.formats)),e=new Tandem.Delta(0,this.length,t),e},t}(LinkedList.Node),window.Scribe||(window.Scribe={}),window.Scribe.Line=e}.call(this),function(){var e;e={applyRules:function(e){var t=this;return Scribe.DOM.traversePreorder(e,0,function(e,t){var n;return e.nodeType===e.ELEMENT_NODE&&(n=Scribe.Constants.LINE_RULES[e.tagName],n!=null?_.each(n,function(t,n){switch(n){case"rename":return e=Scribe.DOM.switchTag(e,t)}}):e=Scribe.DOM.unwrap(e)),e})},breakBlocks:function(e){return this.groupBlocks(e),_.each(Scribe.DOM.filterUneditable(e.querySelectorAll(Scribe.Line.BREAK_TAGS.join(", "))),function(t){return t.tagName!=="BR"&&(t=Scribe.DOM.switchTag(t,"br")),Scribe.Normalizer.normalizeBreak(t,e)}),_.each(Scribe.DOM.filterUneditable(e.querySelectorAll(Scribe.Line.BLOCK_TAGS.join(", "))),function(e){if(e.tagName!=="DIV")return e=Scribe.DOM.switchTag(e,"div")}),_.each(Scribe.DOM.filterUneditable(e.childNodes),function(e){return Scribe.Normalizer.breakLine(e)})},breakLine:function(e){if(e.childNodes.length===1&&e.firstChild.tagName==="BR")return;return Scribe.DOM.traversePostorder(e,function(t){var n;if(Scribe.Utils.isBlock(t)){t.tagName!=="DIV"&&(t=Scribe.DOM.switchTag(t,"div"));if(t.nextSibling!=null){n=e.ownerDocument.createElement("div"),e.parentNode.insertBefore(n,e.nextSibling);while(t.nextSibling!=null)n.appendChild(t.nextSibling);Scribe.Normalizer.breakLine(n)}return Scribe.DOM.unwrap(t)}return t})},groupBlocks:function(e){var t,n,r,i;t=e.firstChild,i=[];while(t!=null)if(Scribe.Utils.isBlock(t))i.push(t=t.nextSibling);else{n=e.ownerDocument.createElement("div"),e.insertBefore(n,t);while(t!=null&&!Scribe.Utils.isBlock(t))r=t.nextSibling,n.appendChild(t),t=r;i.push(t=n)}return i},mergeAdjacent:function(e){return Scribe.DOM.traversePreorder(e,0,function(e){var t,n,r,i,s,o,u;return e.nodeType===e.ELEMENT_NODE&&!Scribe.Line.isLineNode(e)&&(t=e.nextSibling,(t!=null?t.tagName:void 0)===e.tagName&&e.tagName!=="LI"&&Scribe.DOM.canEdit(t)&&(o=Scribe.Utils.getFormatForContainer(e),i=o[0],s=o[1],u=Scribe.Utils.getFormatForContainer(t),n=u[0],r=u[1],i===n&&s===r&&(e=Scribe.DOM.mergeNodes(e,t)))),e})},normalizeBreak:function(e,t){if(e===t)return;if(e.previousSibling!=null)return e.nextSibling!=null&&Scribe.DOM.splitAfter(e,t),e.parentNode.removeChild(e);if(e.nextSibling!=null){if(Scribe.DOM.splitAfter(e,t))return Scribe.Normalizer.normalizeBreak(e,t)}else if(e.parentNode!==t&&e.parentNode.parentNode!==t)return Scribe.DOM.unwrap(e.parentNode),Scribe.Normalizer.normalizeBreak(e,t)},normalizeDoc:function(e){return e.firstChild||e.appendChild(e.ownerDocument.createElement("div")),Scribe.Normalizer.breakBlocks(e),_.each(Scribe.DOM.filterUneditable(e.childNodes),function(e){return Scribe.Normalizer.normalizeLine(e),Scribe.Normalizer.optimizeLine(e)})},normalizeLine:function(e){var t;t=Scribe.DOM.filterUneditable(e.childNodes);if(t.length===1&&t[0].tagName==="BR")return;return this.applyRules(e),this.removeNoBreak(e),this.normalizeSpan(e),this.requireLeaf(e),this.wrapText(e)},normalizeSpan:function(e){return _.each(Scribe.DOM.filterUneditable(e.querySelectorAll("span")),function(e){var t;return t=_.map(e.attributes,function(e){return e.name}),_.each(t,function(t){if(t==="class")return;return e.removeAttribute(t)})})},optimizeLine:function(e){var t;t=Scribe.DOM.filterUneditable(e.childNodes);if(t.length===1&&t[0].tagName==="BR")return;return this.mergeAdjacent(e),this.removeRedundant(e),this.wrapText(e)},requireLeaf:function(e){if(!(Scribe.DOM.filterUneditable(e.childNodes).length>1)){if(e.tagName==="OL"||e.tagName==="UL")e.appendChild(e.ownerDocument.createElement("li")),e=e.firstChild;return e.appendChild(e.ownerDocument.createElement("br"))}},removeNoBreak:function(e){var t=this;return Scribe.DOM.traversePreorder(e,0,function(e){return e.nodeType===e.TEXT_NODE&&(e.textContent=e.textContent.split(Scribe.Constants.NOBREAK_SPACE).join("")),e})},removeRedundant:function(e){var t,n,r=this;return n=_.uniqueId("_scribeFormats"),e[n]={},t=function(t){var r,i,s,o;if(t.nodeType===t.ELEMENT_NODE){if(Scribe.Utils.getNodeLength(t)===0)return t.tagName!=="BR"||Scribe.DOM.filterUneditable(t.parentNode.childNodes).length>1;o=Scribe.Utils.getFormatForContainer(t),i=o[0],s=o[1];if(i!=null)return t.parentNode[n][i]!=null;if(t.tagName==="SPAN"){r=Scribe.DOM.filterUneditable(t.childNodes);if(r.length===0||!_.any(r,function(e){return e.nodeType!==e.ELEMENT_NODE}))return!0;if(t.previousSibling===null&&t.nextSibling===null&&t.parentNode!==e&&t.parentNode.tagName!=="LI")return!0}}return!1},Scribe.DOM.traversePreorder(e,0,function(e){var r,i,s;return t(e)&&(e=Scribe.DOM.unwrap(e)),e!=null&&(e[n]=_.clone(e.parentNode[n]),s=Scribe.Utils.getFormatForContainer(e),r=s[0],i=s[1],r!=null&&(e[n][r]=i)),e}),delete e[n],Scribe.DOM.traversePreorder(e,0,function(e){return delete e[n],e})},wrapText:function(e){var t=this;return Scribe.DOM.traversePreorder(e,0,function(t){var n;return t.normalize(),t.nodeType===t.TEXT_NODE&&(t.nextSibling!=null||t.previousSibling!=null||t.parentNode===e||t.parentNode.tagName==="LI")&&(n=t.ownerDocument.createElement("span"),Scribe.DOM.wrap(n,t),t=n),t})}},window.Scribe||(window.Scribe={}),window.Scribe.Normalizer=e}.call(this),function(){var e;e=function(){function e(e){this.editor=e,this.container=this.editor.root.ownerDocument.createElement("div"),this.container.id="paste-container",this.container.setAttribute("contenteditable",!0),this.editor.renderer.addStyles({"#paste-container":{left:"-10000px",position:"fixed",top:"50%"}}),this.editor.root.parentNode.appendChild(this.container),this.initListeners()}return e.prototype.initListeners=function(){var e=this;return this.editor.root.addEventListener("paste",function(){var t,n;e.editor.selection.deleteRange(),n=e.editor.getSelection();if(n==null)return;return t=e.editor.getLength(),e.container.innerHTML="",e.container.focus(),_.defer(function(){var r,i,s,o,u;return Scribe.Utils.removeExternal(e.container),Scribe.Utils.removeStyles(e.container),i=new Scribe.Document(e.container),s=i.lines.last,s.deleteText(s.length-1,1),r=i.toDelta(),n.start.index>0&&r.ops.unshift(new Tandem.RetainOp(0,n.start.index)),n.start.index<t&&r.ops.push(new Tandem.RetainOp(n.start.index,t)),r.endLength+=t,r.startLength=t,u=e.editor.doc.toDelta(),e.editor.applyDelta(r,!1),o=Math.max(0,e.editor.getLength()-t),e.editor.setSelection(new Scribe.Range(e.editor,n.start.index+o,n.start.index+o))})})},e}(),window.Scribe||(window.Scribe={}),window.Scribe.PasteManager=e}.call(this),function(){var e;e=function(){function e(e,t,n){var r;this.editor=e,this.leafNode=t,this.offset=n,_.isNumber(this.leafNode)?(this.offset=this.index=this.leafNode,this.leafNode=this.editor.root.firstChild):this.index=Scribe.Position.getIndex(this.leafNode,this.offset),r=Scribe.Position.findLeafNode(this.editor,this.leafNode,this.offset),this.leafNode=r[0],this.offset=r[1]}return e.findDeepestNode=function(e,t,n){var r,i;return r=Scribe.Line.isLineNode(t),i=Scribe.Utils.getNodeLength(t),r&&n<i?Scribe.Position.findDeepestNode(e,t.firstChild,Math.min(n,i)):n<i?t.firstChild!=null?Scribe.Position.findDeepestNode(e,t.firstChild,n):[t,n]:t.nextSibling!=null?(n-=i,Scribe.Position.findDeepestNode(e,t.nextSibling,n)):t.lastChild!=null?Scribe.Position.findDeepestNode(e,t.lastChild,Scribe.Utils.getNodeLength(t.lastChild)):[t,n]},e.findLeafNode=function(e,t,n){var r;return r=Scribe.Position.findDeepestNode(e,t,n),t=r[0],n=r[1],t.nodeType===t.TEXT_NODE&&(n=Scribe.Position.getIndex(t,n,t.parentNode),t=t.parentNode),[t,n]},e.getIndex=function(e,t,n){n==null&&(n=null);while(e!==n&&(e!=null?e.id:void 0)!==Scribe.Editor.CONTAINER_ID){while(e.previousSibling!=null)e=e.previousSibling,t+=Scribe.Utils.getNodeLength(e);e=e.parentNode}return t},e.prototype.getLeaf=function(){return this.leaf!=null?this.leaf:(this.leaf=this.editor.doc.findLeaf(this.leafNode),this.leaf)},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Position=e}.call(this),function(){var e;rangy.init(),e=function(){function e(e,t,n){this.editor=e,this.start=t,this.end=n,_.isNumber(this.start)&&(this.start=new Scribe.Position(this.editor,this.start)),_.isNumber(this.end)&&(this.end=new Scribe.Position(this.editor,this.end))}return e.prototype.equals=function(e){return e==null?!1:e.start.leafNode===this.start.leafNode&&e.end.leafNode===this.end.leafNode&&e.start.offset===this.start.offset&&e.end.offset===this.end.offset},e.prototype.getFormats=function(){var e,t,n,r;return this.formats!=null?this.formats:(r=this.start.getLeaf(),e=this.end.getLeaf(),r==null||e==null?{}:this.isCollapsed()?r.getFormats():(n=this.getLeaves(),n.length>1&&this.end.offset===0&&n.pop(),n.length>1&&this.start.offset===n[0].length&&n.splice(0,1),t=n.length>0?n[0].getFormats():{},_.all(n,function(e){var n;return n=e.getFormats(),_.each(t,function(e,r){if(!n[r])return delete t[r];if(n[r]!==e)return _.isArray(e)||(t[r]=[e]),t[r].push(n[r])}),_.keys(t).length>0}),_.each(t,function(e,n){if(_.isArray(e))return t[n]=_.uniq(e)}),this.formats=t,t))},e.prototype.getLeafNodes=function(){var e,t;return t=this.getRangy(),t.collapsed?[this.start.leafNode]:(e=_.map(t.getNodes([3]),function(e){return e.parentNode}),(e[e.length-1]!==this.end.leafNode||this.end.offset===0)&&e.pop(),e)},e.prototype.getLeaves=function(){var e,t;return t=new Scribe.LeafIterator(this.start.getLeaf(),this.end.getLeaf()),e=t.toArray(),e},e.prototype.getLineNodes=function(){var e,t,n;n=this.editor.doc.findLineNode(this.start.leafNode),e=this.editor.doc.findLineNode(this.end.leafNode);if(n===e)return[n];t=[];while(n!==e)t.push(n),n=n.nextSibling;return t.push(e),t},e.prototype.getLines=function(){var e=this;return _.map(this.getLineNodes(),function(t){return e.editor.doc.findLine(t)})},e.prototype.getRangy=function(){var e;return e=rangy.createRangyRange(this.editor.contentWindow),this.start.leafNode.nodeName!=="BR"&&this.start.leafNode.firstChild!=null?e.setStart(this.start.leafNode.firstChild,this.start.offset):e.setStart(this.start.leafNode,0),this.end.leafNode.nodeName!=="BR"&&this.end.leafNode.firstChild!=null?e.setEnd(this.end.leafNode.firstChild,this.end.offset):e.setEnd(this.end.leafNode,0),e},e.prototype.getText=function(){var e,t,n=this;return e=this.getLeaves(),e.length===0?"":(t=e[0].line,_.map(e,function(e){var r;return r=e.text,e===n.end.getLeaf()&&(r=r.substring(0,n.end.offset)),e===n.start.getLeaf()&&(r=r.substring(n.start.offset)),t!==e.line&&(r="\n"+r,t=e.line),r}).join(""))},e.prototype.isCollapsed=function(){return this.start.leafNode===this.end.leafNode&&this.start.offset===this.end.offset},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Range=e}.call(this),function(){var e;e=function(){function e(e,t){this.container=e,this.options=_.extend(Scribe.Renderer.DEFAULTS,t),this.createFrame()}return e.DEFAULTS={keepHTML:!1},e.DEFAULT_STYLES={".editor":{bottom:"10px","font-family":"'Helvetica', 'Arial', san-serif","font-size":"13px",left:"15px","line-height":"15px",outline:"none",position:"absolute",right:"15px","tab-size":"4",top:"10px","white-space":"pre-wrap"},html:{height:"100%"},body:{cursor:"text",height:"100%",margin:"0px",padding:"0px"},".line:last-child":{"padding-bottom":"10px"},a:{"text-decoration":"underline"},b:{"font-weight":"bold"},i:{"font-style":"italic"},s:{"text-decoration":"line-through"},u:{"text-decoration":"underline"},ol:{margin:"0px",padding:"0px"},ul:{"list-style-type":"disc",margin:"0px",padding:"0px"},"ol.indent-1":{"list-style-type":"decimal"},"ol.indent-2":{"list-style-type":"lower-alpha"},"ol.indent-3":{"list-style-type":"lower-roman"},"ol.indent-4":{"list-style-type":"decimal"},"ol.indent-5":{"list-style-type":"lower-alpha"},"ol.indent-6":{"list-style-type":"lower-roman"},"ol.indent-7":{"list-style-type":"decimal"},"ol.indent-8":{"list-style-type":"lower-alpha"},"ol.indent-9":{"list-style-type":"lower-roman"},".background-black":{"background-color":"black"},".background-red":{"background-color":"red"},".background-orange":{"background-color":"orange"},".background-yellow":{"background-color":"yellow"},".background-green":{"background-color":"green"},".background-blue":{"background-color":"blue"},".background-purple":{"background-color":"purple"},".color-white":{color:"white"},".color-red":{color:"red"},".color-orange":{color:"orange"},".color-yellow":{color:"yellow"},".color-green":{color:"green"},".color-blue":{color:"blue"},".color-purple":{color:"purple"},".family-monospace":{"font-family":"'Courier New', monospace"},".family-serif":{"font-family":"'Times New Roman', serif"},".size-huge":{"font-size":"32px","line-height":"36px"},".size-large":{"font-size":"18px","line-height":"22px"},".size-small":{"font-size":"10px","line-height":"12px"},".indent-1":{"margin-left":"2em"},".indent-2":{"margin-left":"4em"},".indent-3":{"margin-left":"6em"},".indent-4":{"margin-left":"8em"},".indent-5":{"margin-left":"10em"},".indent-6":{"margin-left":"12em"},".indent-7":{"margin-left":"14em"},".indent-8":{"margin-left":"16em"},".indent-9":{"margin-left":"18em"}},e.objToCss=function(e){return _.map(e,function(e,t){var n;return n=_.map(e,function(e,t){return""+t+": "+e+";"}).join(" "),""+t+" { "+n+" }"}).join("\n")},e.prototype.addStyles=function(e){var t,n,r,i;return n=this.iframe.contentWindow.document,r=n.getElementsByTagName("head")[0],i=n.createElement("style"),i.type="text/css",t=Scribe.Renderer.objToCss(e),i.styleSheet!=null?i.styleSheet.cssText=t:i.appendChild(n.createTextNode(t)),r.appendChild(i)},e.prototype.createFrame=function(){var e,t,n,r;n=this.container.innerHTML,this.container.innerHTML="",this.iframe=this.container.ownerDocument.createElement("iframe"),this.iframe.frameborder=0,this.iframe.src="javascript:;",this.iframe.height=this.iframe.width="100%",this.container.appendChild(this.iframe),t=this.iframe.contentWindow.document,r=_.map(this.options.styles,function(e,t){var n;return n=Scribe.Renderer.DEFAULT_STYLES[t]||{},_.extend(n,e)}),r=_.extend(Scribe.Renderer.DEFAULT_STYLES,r),this.addStyles(r),e=t.createElement("div"),e.id=Scribe.Editor.CONTAINER_ID,e.classList.add("editor"),t.body.appendChild(e);if(this.options.keepHTML)return e.innerHTML=n},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Renderer=e}.call(this),function(){var e;e=function(){function e(e){this.editor=e,this.range=null,this.initListeners()}return e.prototype.initListeners=function(){var e,t,n=this;return e=function(){return n.update()},t=function(t){if(Scribe.Keyboard.KEYS.LEFT<=t.which&&t.which<=Scribe.Keyboard.KEYS.DOWN)return e()},this.editor.root.addEventListener("keyup",t),this.editor.root.addEventListener("mouseup",e)},e.prototype.format=function(e,t){var n,r,i;this.update();if(!this.range)return;return i=this.range.start.index,n=this.range.end.index,r=this.range.getFormats(),n>i&&this.editor.formatAt(i,n-i,e,t),r[e]=t,this.range.formats=r,this.editor.emit(Scribe.Editor.events.SELECTION_CHANGE,this.range),this.setRange(new Scribe.Range(this.editor,i,n))},e.prototype.deleteRange=function(){return this.update(),this.range.isCollapsed()?!1:(this.editor.deleteAt(this.range.start.index,this.range.end.index-this.range.start.index),this.update(),this.range)},e.prototype.getNative=function(){var e,t,n,r,i,s,o,u;return i=rangy.getSelection(this.editor.contentWindow),s=window.getSelection(),i.anchorNode==null||i.focusNode==null?null:(i.isBackwards()?(u=[i.anchorNode,i.anchorOffset,i.focusNode,i.focusOffset],n=u[0],r=u[1],e=u[2],t=u[3]):(o=[i.anchorNode,i.anchorOffset,i.focusNode,i.focusOffset],e=o[0],t=o[1],n=o[2],r=o[3]),{anchorNode:e,anchorOffset:t,focusNode:n,focusOffset:r})},e.prototype.getRange=function(){var e,t,n;return t=this.getNative(),t==null?null:(n=new Scribe.Position(this.editor,t.anchorNode,t.anchorOffset),e=new Scribe.Position(this.editor,t.focusNode,t.focusOffset),new Scribe.Range(this.editor,n,e))},e.prototype.preserve=function(e){var t;return this.range!=null?(t=this.save(),e.call(null),this.restore(t)):e.call(null)},e.prototype.restore=function(e){return rangy.restoreSelection(e,!1),this.update(!0)},e.prototype.save=function(){var e;return e=rangy.saveSelection(this.editor.contentWindow),_.each(e.rangeInfos,function(e){return _.each([e.startMarkerId,e.endMarkerId,e.markerId],function(t){var n;n=e.document.getElementById(t);if((n!=null?n.classList:void 0)!=null)return n.classList.add(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)})}),e},e.prototype.setRange=function(e,t){var n,r;this.range=e,t==null&&(t=!1),n=rangy.getSelection(this.editor.contentWindow),this.range!=null?(r=this.range.getRangy(),n.setSingleRange(r)):n.removeAllRanges();if(!t)return this.editor.emit(Scribe.Editor.events.SELECTION_CHANGE,this.range)},e.prototype.setRangeNative=function(e){var t,n;return n=rangy.getSelection(this.editor.contentWindow),t=rangy.createRangyRange(this.editor.contentWindow),t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),n.setSingleRange(t)},e.prototype.update=function(e){var t,n;e==null&&(e=!1),t=this.getRange();if(t!==this.range&&((n=this.range)!=null?!n.equals(t):!void 0))return e||this.editor.emit(Scribe.Editor.events.SELECTION_CHANGE,t),this.range=t},e}(),window.Scribe||(window.Scribe={}),window.Scribe.Selection=e}.call(this),function(){var e;e=function(){function e(e,t){this.editor=e,t==null&&(t={}),this.undoStack=[],this.redoStack=[],this.options=_.extend(Scribe.UndoManager.DEFAULTS,t),this.lastRecorded=0,this.initListeners()}return e.DEFAULTS={delay:1e3},e.computeUndo=function(e,t){var n,r,i,s;return r=i=0,s=[],_.each(e.ops,function(e){var n,o,u;return Tandem.Delta.isInsert(e)?i+=e.getLength():Tandem.Delta.isRetain(e)?(u=r+i,e.start>r&&(o=e.start-r,n=t.getOpsAt(r,o),s=s.concat(n),i-=o),s.push(new Tandem.RetainOp(u,u+e.getLength(),e.attributes)),r=e.end):console.error("Unrecognized type in op",e)}),e.endLength<e.startLength+i&&(n=t.getOpsAt(e.endLength-i,e.startLength-e.endLength+i),s=s.concat(n)),new Tandem.Delta(e.endLength,e.startLength,s)},e.getLastChangeIndex=function(e){var t,n,r;return n=t=r=0,_.each(e.ops,function(e){if(Tandem.Delta.isInsert(e))return r+=e.getLength(),n=t+r;if(Tandem.Delta.isRetain(e))return e.start>t&&(n=t+r,r-=e.start-t),t=e.end}),e.endLength<e.startLength+r&&(n=e.endLength),n},e.prototype.initListeners=function(){var e=this;return this.editor.keyboard.addHotkey(Scribe.Keyboard.HOTKEYS.UNDO,function(){return e.undo()}),this.editor.keyboard.addHotkey(Scribe.Keyboard.HOTKEYS.REDO,function(){return e.redo()})},e.prototype.record=function(e,t){var n,r,i;if(e.isIdentity(e))return;return this.redoStack=[],i=Scribe.UndoManager.computeUndo(e,t),r=(new Date).getTime(),this.lastRecorded+this.options.delay>r&&this.undoStack.length>0?(n=this.undoStack.pop(),i=i.compose(n.undo.delta),e=n.redo.delta.compose(e)):this.lastRecorded=r,this.undoStack.push({undo:{cursor:Scribe.UndoManager.getLastChangeIndex(i),delta:i},redo:{cursor:Scribe.UndoManager.getLastChangeIndex(e),delta:e}})},e.prototype.redo=function(){var e;if(this.redoStack.length>0)return e=this.redoStack.pop(),this.editor.applyDelta(e.redo.delta),this.editor.setSelection(new Scribe.Range(this.editor,e.redo.cursor,e.redo.cursor)),this.undoStack.push(e)},e.prototype.undo=function(){var e;if(this.undoStack.length>0)return e=this.undoStack.pop(),this.editor.applyDelta(e.undo.delta),this.editor.setSelection(new Scribe.Range(this.editor,e.undo.cursor,e.undo.cursor)),this.redoStack.push(e)},e}(),window.Scribe||(window.Scribe={}),window.Scribe.UndoManager=e}.call(this),function(){var e;e={cleanHtml:function(e,t){return t==null&&(t=!1),e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),e=e.replace(/>\s\s+</gi,"><"),t!==!0&&(e=e.replace(/\ (class|id)="[a-z0-9\-_]+"/gi,"")),e=e.replace(/<br><\/br>/,"<br>"),e},createContainerForFormat:function(e,t,n){var r,i;switch(t){case"bold":return e.createElement("b");case"italic":return e.createElement("i");case"strike":return e.createElement("s");case"underline":return e.createElement("u");case"link":return r=e.createElement("a"),n.match(/https?:\/\//)||(n="https://"+n),r.href=n,r.protocol!=="http:"&&r.protocol!=="https:"&&(r.href="about:blank"),r.title=r.href,r;default:return i=e.createElement("span"),i.classList.add(""+t+"-"+n),i}},cloneAncestors:function(e,t){var n,r;n=e.cloneNode(!1),e=e.parentNode;while(e!=null&&e!==t)r=e.cloneNode(!1),r.appendChild(n),n=r,e=e.parentNode;return n},findAncestor:function(e,t){while(e!=null&&!t(e))e=e.parentNode;return e},getFormatDefault:function(e){return Scribe.Constants.DEFAULT_LEAF_FORMATS[e]||!1},getFormatForContainer:function(e){var t,n;switch(e.tagName){case"A":return["link",e.getAttribute("href")];case"B":return["bold",!0];case"I":return["italic",!0];case"S":return["strike",!0];case"U":return["underline",!0];case"OL":return["list",Scribe.Utils.getIndent(e)];case"UL":return["bullet",Scribe.Utils.getIndent(e)];case"DIV":return n=Scribe.Utils.getIndent(e),n>0?["indent",n]:[];case"SPAN":return t=[],_.any(e.classList,function(e){var n,r,i;r=e.split("-");if(r.length>1){n=r[0],i=r.slice(1).join("-");if(Scribe.Constants.SPAN_FORMATS[n]!=null)return t=[n,i],!0}return!1}),t;default:return[]}},getChildAtOffset:function(e,t){var n,r;n=e.firstChild,r=Scribe.Utils.getNodeLength(n);while(n!=null){if(t<r)break;t-=r,n=n.nextSibling,r=Scribe.Utils.getNodeLength(n)}return n==null&&(n=e.lastChild,t=Scribe.Utils.getNodeLength(n)),[n,t]},getIndent:function(e){var t;return t=0,_.any(e.classList,function(e){return e.substring(0,Scribe.Document.INDENT_PREFIX.length)===Scribe.Document.INDENT_PREFIX?(t=parseInt(e.substring(Scribe.Document.INDENT_PREFIX.length)),!0):!1}),t},getNodeLength:function(e){var t,n;return e==null?0:e.nodeType===e.ELEMENT_NODE?e.classList.contains(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)?0:(t=e.querySelectorAll("."+Scribe.Constants.SPECIAL_CLASSES.EXTERNAL),n=_.reduce(t,function(e,t){return e-t.textContent.length},e.textContent.length),n+(Scribe.Line.isLineNode(e)?1:0)):e.nodeType===e.TEXT_NODE?e.textContent.length:0},groupBlocks:function(e){var t,n,r,i;t=e.firstChild,n=null,i=[];while(t!=null)r=t.nextSibling,Scribe.Utils.isBlock(t)?n!=null&&(n=null):(n==null&&(n=e.ownerDocument.createElement("div"),t.parentNode.insertBefore(n,t)),n.appendChild(t)),i.push(t=r);return i},isBlock:function(e){return _.indexOf(Scribe.Line.BLOCK_TAGS,e.tagName)>-1},insertExternal:function(e,t){return e.leafNode.lastChild!=null?e.leafNode.lastChild.nodeType===e.leafNode.TEXT_NODE?(e.leafNode.lastChild.splitText(e.offset),e.leafNode.insertBefore(t,e.leafNode.lastChild)):e.leafNode.parentNode.insertBefore(t,e.leafNode):(e.offset!==0&&console.warn("offset is not 0",e.offset),e.leafNode.parentNode.insertBefore(t,e.leafNode))},moveExternal:function(e,t,n){var r;return r=_.clone(e.querySelectorAll("."+Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)),_.each(r,function(e){return t.insertBefore(e,n)})},removeFormatFromSubtree:function(e,t){var n,r,i,s,o,u;return n=Scribe.DOM.filterUneditable(e.childNodes),r=Scribe.Utils.getFormatForContainer(e),u=Scribe.Utils.getFormatForContainer(e),i=u[0],o=u[1],s=e,i===t&&(s=Scribe.DOM.unwrap(e)),_.each(n,function(e){return Scribe.Utils.removeFormatFromSubtree(e,t)}),s},removeExternal:function(e){var t;return t=_.clone(e.querySelectorAll("."+Scribe.Constants.SPECIAL_CLASSES.EXTERNAL)),_.each(t,function(e){if(e.parentNode!=null)return e.parentNode.removeChild(e)})},removeNode:function(e){var t,n;if(e.parentNode==null)return;if(Scribe.Line.isLineNode(e)){n=e.previousSibling,t=e.nextSibling;for(;;){if(Scribe.Line.isLineNode(n)){Scribe.Utils.moveExternal(e,n,null);break}if(Scribe.Line.isLineNode(t)){Scribe.Utils.moveExternal(e,t,t.firstChild);break}if(n==null&&t==null){console.warn("External nodes might have no where to go!"),Scribe.Utils.moveExternal(e,e.parentNode,e.nextSibling);break}n!=null&&(n=n.previousSibling),t!=null&&(t=t.nextSibling)}}else Scribe.Utils.moveExternal(e,e.parentNode,e.nextSibling);return e.parentNode.removeChild(e)},removeStyles:function(e){var t,n;t=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1),t.firstChild(),t.currentNode.removeAttribute("style"),n=[];while(t.nextNode())n.push(t.currentNode.removeAttribute("style"));return n},setIndent:function(e,t){_.each(_.clone(e.classList),function(t){if(t.substring(0,Scribe.Document.INDENT_PREFIX.length)===Scribe.Document.INDENT_PREFIX)return e.classList.remove(t)});if(t)return e.classList.add(Scribe.Document.INDENT_PREFIX+t)}},window.Scribe||(window.Scribe={}),window.Scribe.Utils=e}.call(this),function(){var e;e=function(){function e(e){this.editor=e,this.cursors={},this.editor.renderer.addStyle({"#cursor-container":{"font-family":"'Helvetica', 'Arial', san-serif","font-size":"13px","line-height":"15px"},".cursor":{display:"inline-block",height:"12px",position:"absolute",width:"0px"},".cursor-name":{"border-bottom-right-radius":"3px","border-top-left-radius":"3px","border-top-right-radius":"3px",color:"white",display:"inline-block",left:"-1px",padding:"2px 8px",position:"absolute",top:"-18px"},".cursor-inner":{display:"inline-block",width:"2px",position:"absolute",height:"15px",left:"-1px"},".editor > .line:first-child .cursor-name":{"border-top-left-radius":"0px","border-bottom-left-radius":"3px",top:"15px"}}),this.root=this.editor.root}return e.prototype.shiftCursors=function(e,t){var n=this;return _.each(this.cursors,function(r,i){if(r===void 0||r.index<e)return;if(r.index>e)return t>0?n.setCursor(r.userId,r.index+t,r.name,r.color):n.setCursor(r.userId,r.index+Math.max(t,e-r.index),r.name,r.color)})},e.prototype.setCursor=function(e,t,n,r){var i,s,o,u,a,f,l,c,h;i=this.root.ownerDocument.getElementById(Scribe.Editor.CURSOR_PREFIX+e),i==null&&(i=this.root.ownerDocument.createElement("span"),i.classList.add("cursor"),i.classList.add(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL),i.id=Scribe.Editor.CURSOR_PREFIX+e,o=this.root.ownerDocument.createElement("span"),o.classList.add("cursor-inner"),o.classList.add(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL),a=this.root.ownerDocument.createElement("span"),a.classList.add("cursor-name"),a.classList.add(Scribe.Constants.SPECIAL_CLASSES.EXTERNAL),a.textContent=n,o.style["background-color"]=a.style["background-color"]=r,i.appendChild(a),i.appendChild(o),this.cursorContainer.appendChild(i)),this.cursors[e]={index:t,name:n,color:r,userId:e},f=new Scribe.Position(this,t),h=Scribe.DOM.splitNode(f.leafNode,f.offset),u=h[0],l=h[1],s=h[2];if(l==null||l.offsetTop===0&&l.offsetLeft===0)return u!=null?(c=u.ownerDocument.createElement("span"),u.parentNode.appendChild(c),i.style.top=c.offsetTop,i.style.left=c.offsetLeft,c.parentNode.removeChild(c)):l!=null?(i.style.top=l.parentNode.offsetTop,i.style.left=l.parentNode.offsetLeft):console.warn("Could not set cursor");i.style.top=l.parentNode,i.style.top=l.offsetTop,i.style.left=l.offsetLeft;if(s)return Scribe.DOM.mergeNodes(u,l)},e.prototype.moveCursor=function(e,t){if(this.cursors[e])return this.setCursor(e,t,this.cursors[e].name,this.cursors[e].color)},e.prototype.clearCursors=function(){return _.each(this.root.querySelectorAll(".cursor"),function(e){return e.parentNode.removeChild(e)})},e.prototype.removeCursor=function(e){var t;t=this.root.ownerDocument.getElementById(Scribe.Editor.CURSOR_PREFIX+e);if(t!=null)return t.parentNode.removeChild(t)},e}(),window.Scribe||(window.Scribe={}),window.Scribe.MultiCursorManager=e}.call(this),function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t=function(){var e=this;return _.each(Scribe.Toolbar.BUTTON_FORMATS,function(t){var n;n=e.container.querySelector("."+t);if(n==null)return;return n.addEventListener("click",function(){var r;return r=!n.classList.contains("active"),e.editor.selection.format(t,r),e.emit(Scribe.Toolbar.events.FORMAT,t,r)})})},n=function(){var e,t=this;e=this.container.querySelector(".link");if(e==null)return;return e.addEventListener("click",function(){var n,r;return r=!1,e.classList.contains("active")||(n=t.editor.selection.getRange(),r=n.getText()),t.editor.selection.format("link",r),t.emit(Scribe.Toolbar.events.FORMAT,"link",r)})},r=function(){var e=this;return _.each(Scribe.Toolbar.SELECT_FORMATS,function(t){var n;n=e.container.querySelector("."+t);if(n==null)return;return n.addEventListener("change",function(){var r;return r=n.options[n.selectedIndex].value,e.editor.selection.format(t,r),e.emit(Scribe.Toolbar.events.FORMAT,t,r)})})},i=function(){var e=this;return this.editor.on(Scribe.Editor.events.SELECTION_CHANGE,function(t){var n;return n=t.getFormats(),_.each(e.container.querySelectorAll(".active"),function(e){return e.classList.remove("active")}),_.each(n,function(t,n){var r;if(t!=null){r=e.container.querySelector("."+n);if(r==null)return;return r.tagName==="SELECT"?(_.isArray(t)&&(t=""),r.value=t):r.classList.add("active")}})})},e=function(e){function s(e,s){this.container=e,this.editor=s,_.isString(this.container)&&(this.container=document.getElementById(this.container)),t.call(this),n.call(this),r.call(this),i.call(this)}return o(s,e),s.BUTTON_FORMATS=["bold","italic","strike","underline","bullet","list","indent","outdent"],s.SELECT_FORMATS=["background","color","family","size"],s.events={FORMAT:"format"},s}(EventEmitter2),window.Scribe||(window.Scribe={}),window.Scribe.Toolbar=e}.call(this);